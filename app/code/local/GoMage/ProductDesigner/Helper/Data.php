<?php eval(base64_decode("Ci8qKgogKiBHb01hZ2UgUHJvZHVjdCBEZXNpZ25lciBFeHRlbnNpb24KICoKICogQGNhdGVnb3J5ICAgICBFeHRlbnNpb24KICogQGNvcHlyaWdodCAgICBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNyBHb01hZ2UgKGh0dHBzOi8vd3d3LmdvbWFnZS5jb20pCiAqIEBhdXRob3IgICAgICAgR29NYWdlCiAqIEBsaWNlbnNlICAgICAgaHR0cHM6Ly93d3cuZ29tYWdlLmNvbS9saWNlbnNlLWFncmVlbWVudC8gIFNpbmdsZSBkb21haW4gbGljZW5zZQogKiBAdGVybXMgb2YgdXNlIGh0dHBzOi8vd3d3LmdvbWFnZS5jb20vdGVybXMtb2YtdXNlLwogKiBAdmVyc2lvbiAgICAgIFJlbGVhc2U6IDIuNS4wCiAqIEBzaW5jZSAgICAgICAgQXZhaWxhYmxlIHNpbmNlIFJlbGVhc2UgMS4wLjAKICovCmNsYXNzIEdvTWFnZV9Qcm9kdWN0RGVzaWduZXJfSGVscGVyX0RhdGEgZXh0ZW5kcyBNYWdlX0NvcmVfSGVscGVyX0Fic3RyYWN0CnsKICAgIGNvbnN0IEFEVkFOQ0VEX05BVklHQVRJT05fTU9EVUxFX05BTUUgPSAnR29NYWdlX05hdmlnYXRpb24nOwoKICAgIHByb3RlY3RlZCAkX2FsbG93ZWRQcm9kdWN0VHlwZXMgPSBhcnJheSgKICAgICAgICBNYWdlX0NhdGFsb2dfTW9kZWxfUHJvZHVjdF9UeXBlOjpUWVBFX1NJTVBMRSwKICAgICAgICBNYWdlX0NhdGFsb2dfTW9kZWxfUHJvZHVjdF9UeXBlOjpUWVBFX0NPTkZJR1VSQUJMRQogICAgKTsKCiAgICBwcm90ZWN0ZWQgJF9wcm9kdWN0U2V0dGluZ3M7CgogICAgcHJvdGVjdGVkICRfcHJvZHVjdERlc2lnbiA9IG51bGw7CgogICAgcHJvdGVjdGVkICRfZWRpdG9yQ29uZmlnID0gbnVsbDsKCiAgICBwdWJsaWMgZnVuY3Rpb24gaXNFbmFibGVkKCkKICAgIHsKICAgICAgICByZXR1cm4gTWFnZTo6Z2V0U3RvcmVDb25maWcoJ2dvbWFnZV9kZXNpZ25lci9nZW5lcmFsL2VuYWJsZWQnLCBNYWdlOjphcHAoKS0+Z2V0U3RvcmUoKSk7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGlzTmF2aWdhdGlvbkVuYWJsZWQoKQogICAgewogICAgICAgIHJldHVybiBNYWdlOjpnZXRTdG9yZUNvbmZpZygnZ29tYWdlX2Rlc2lnbmVyL25hdmlnYXRpb24vZW5hYmxlZCcsIE1hZ2U6OmFwcCgpLT5nZXRTdG9yZSgpKTsKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gYWR2YW5jZWROYXZpZ2F0aW9uRW5hYmxlZCgpCiAgICB7CiAgICAgICAgJG1vZHVsZXMgPSAoYXJyYXkpTWFnZTo6Z2V0Q29uZmlnKCktPmdldE5vZGUoJ21vZHVsZXMnKS0+Y2hpbGRyZW4oKTsKICAgICAgICBpZiAoaXNzZXQoJG1vZHVsZXNbc2VsZjo6QURWQU5DRURfTkFWSUdBVElPTl9NT0RVTEVfTkFNRV0pKSB7CiAgICAgICAgICAgICRtb2R1bGUgPSAkbW9kdWxlc1tzZWxmOjpBRFZBTkNFRF9OQVZJR0FUSU9OX01PRFVMRV9OQU1FXTsKICAgICAgICAgICAgcmV0dXJuICRtb2R1bGUtPmlzKCdhY3RpdmUnKSAmJiBNYWdlOjpnZXRTdG9yZUNvbmZpZygnZ29tYWdlX25hdmlnYXRpb24vZ2VuZXJhbC9tb2RlJyk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGlzRW50ZXJwcmlzZUVkaXRpb24oKQogICAgewogICAgICAgICRtb2R1bGVzID0gKGFycmF5KU1hZ2U6OmdldENvbmZpZygpLT5nZXROb2RlKCdtb2R1bGVzJyktPmNoaWxkcmVuKCk7CiAgICAgICAgcmV0dXJuIGlzc2V0KCRtb2R1bGVzWydFbnRlcnByaXNlX1RhcmdldFJ1bGUnXSk7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGlzTW9kdWxlRXhpc3RzKCRtb2R1bGVOYW1lKQogICAgewogICAgICAgICRtb2R1bGVzID0gKGFycmF5KU1hZ2U6OmdldENvbmZpZygpLT5nZXROb2RlKCdtb2R1bGVzJyktPmNoaWxkcmVuKCk7CiAgICAgICAgcmV0dXJuIGlzc2V0KCRtb2R1bGVzWyRtb2R1bGVOYW1lXSk7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGdldElzQW55bW9yZVZlcnNpb24oJG1ham9yLCAkbWlub3IsICRyZXZpc2lvbiA9IDApCiAgICB7CiAgICAgICAgJHZlcnNpb25faW5mbyA9IE1hZ2U6OmdldFZlcnNpb25JbmZvKCk7CgogICAgICAgIGlmICgkdmVyc2lvbl9pbmZvWydtYWpvciddID4gJG1ham9yKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZWxzZWlmICgkdmVyc2lvbl9pbmZvWydtYWpvciddID09ICRtYWpvcikgewogICAgICAgICAgICBpZiAoJHZlcnNpb25faW5mb1snbWlub3InXSA+ICRtaW5vcikgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0gZWxzZWlmICgkdmVyc2lvbl9pbmZvWydtaW5vciddID09ICRtaW5vcikgewogICAgICAgICAgICAgICAgaWYgKCR2ZXJzaW9uX2luZm9bJ3JldmlzaW9uJ10gPj0gJHJldmlzaW9uKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhbGxvd2VkIHByb2R1Y3QgdHlwZXMKICAgICAqCiAgICAgKiBAcmV0dXJuIGFycmF5CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRBbGxvd2VkUHJvZHVjdFR5cGVzKCkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPl9hbGxvd2VkUHJvZHVjdFR5cGVzOwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBoYXNDb2xvckF0dHJpYnV0ZSgpCiAgICB7CiAgICAgICAgJGF0dHJpYnV0ZUNvZGUgPSBNYWdlOjpnZXRTdG9yZUNvbmZpZygnZ29tYWdlX2Rlc2lnbmVyL25hdmlnYXRpb24vY29sb3JfYXR0cmlidXRlJyk7CiAgICAgICAgJGF0dHJpYnV0ZSAgICAgPSBNYWdlOjpnZXRTaW5nbGV0b24oJ2Vhdi9jb25maWcnKQogICAgICAgICAgICAtPmdldEF0dHJpYnV0ZShNYWdlX0NhdGFsb2dfTW9kZWxfUHJvZHVjdDo6RU5USVRZLCAkYXR0cmlidXRlQ29kZSk7CiAgICAgICAgcmV0dXJuICRhdHRyaWJ1dGUtPmdldElkKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gSW1hZ2UgU2V0dGluZ3MKICAgICAqCiAgICAgKiBAcGFyYW0gTWFnZV9DYXRhbG9nX01vZGVsX1Byb2R1Y3QgJHByb2R1Y3QgUHJvZHVjdAogICAgICogQHBhcmFtIGludCAkaW1hZ2VJZCBJbWFnZSBJZAogICAgICogQHJldHVybiBib29sZWFufGFycmF5CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRJbWFnZVNldHRpbmdzKE1hZ2VfQ2F0YWxvZ19Nb2RlbF9Qcm9kdWN0ICRwcm9kdWN0LCAkaW1hZ2VJZCkKICAgIHsKICAgICAgICAkc2V0dGluZ3MgPSAkdGhpcy0+Z2V0U2V0dGluZ3MoJHByb2R1Y3QpOwogICAgICAgIGlmIChpc3NldCgkc2V0dGluZ3NbJGltYWdlSWRdKSkgewogICAgICAgICAgICByZXR1cm4gJHNldHRpbmdzWyRpbWFnZUlkXTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIFByb2R1Y3QgaW1hZ2VzIHNldHRpbmdzCiAgICAgKgogICAgICogQHBhcmFtIE1hZ2VfQ2F0YWxvZ19Nb2RlbF9Qcm9kdWN0ICRwcm9kdWN0IFByb2R1Y3QKICAgICAqIEByZXR1cm4gYXJyYXkKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldFNldHRpbmdzKE1hZ2VfQ2F0YWxvZ19Nb2RlbF9Qcm9kdWN0ICRwcm9kdWN0KQogICAgewogICAgICAgIGlmICghJHRoaXMtPl9wcm9kdWN0U2V0dGluZ3MpIHsKICAgICAgICAgICAgJHNldHRpbmdzID0gYXJyYXkoKTsKICAgICAgICAgICAgJGltYWdlcyAgID0gJHByb2R1Y3QtPmdldE1lZGlhR2FsbGVyeUltYWdlcygpOwogICAgICAgICAgICBmb3JlYWNoICgkaW1hZ2VzIGFzICRpbWFnZSkgewogICAgICAgICAgICAgICAgaWYgKCRpbWFnZVsnZGVzaWduX2FyZWEnXSkgewogICAgICAgICAgICAgICAgICAgICRkZXNpZ25BcmVhID0gTWFnZTo6aGVscGVyKCdjb3JlJyktPmpzb25EZWNvZGUoJGltYWdlWydkZXNpZ25fYXJlYSddKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRpbWFnZUlkICAgID0gJGltYWdlWyd2YWx1ZV9pZCddOwogICAgICAgICAgICAgICAgaWYgKGlzc2V0KCRkZXNpZ25BcmVhKSAmJiAkZGVzaWduQXJlYSAmJiAhZW1wdHkoJGRlc2lnbkFyZWEpKSB7CiAgICAgICAgICAgICAgICAgICAgJGltYWdlVXJsICAgPSAkdGhpcy0+Z2V0RGVzaWduSW1hZ2VVcmwoJHByb2R1Y3QsICRpbWFnZSk7CiAgICAgICAgICAgICAgICAgICAgJGRpbWVuc2lvbnMgPSAkdGhpcy0+Z2V0SW1hZ2VEaW1lbnNpb25zKCRpbWFnZVVybCk7CgogICAgICAgICAgICAgICAgICAgICRiYXNlVXJsID0gTWFnZTo6Z2V0QmFzZVVybCgnbWVkaWEnKTsKICAgICAgICAgICAgICAgICAgICAkYmFzZURpciA9IE1hZ2U6OmdldEJhc2VEaXIoJ21lZGlhJykgLiBEUzsKCiAgICAgICAgICAgICAgICAgICAgJGRlc2lnbkFyZWFbJ3BhdGgnXSAgICAgICAgICAgPSBzdHJfcmVwbGFjZSgkYmFzZVVybCwgJGJhc2VEaXIsICRpbWFnZVVybCk7CiAgICAgICAgICAgICAgICAgICAgJGRlc2lnbkFyZWFbJ2RpbWVuc2lvbnMnXSAgICAgPSBhcnJheSgKICAgICAgICAgICAgICAgICAgICAgICAgJ3dpZHRoJyAgPT4gJGRpbWVuc2lvbnNbMF0sCiAgICAgICAgICAgICAgICAgICAgICAgICdoZWlnaHQnID0+ICRkaW1lbnNpb25zWzFdCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAkZGVzaWduQXJlYVsnb3JpZ2luYWxfaW1hZ2UnXSA9ICR0aGlzLT5nZXRPcmlnaW5hbEltYWdlKCRwcm9kdWN0LCAkaW1hZ2UpOwogICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkZGVzaWduQXJlYVsnb3JpZ2luYWxfaW1hZ2UnXVsndXJsJ10pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRkZXNpZ25BcmVhWydvcmlnaW5hbF9pbWFnZSddWydwYXRoJ10gPSBzdHJfcmVwbGFjZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRiYXNlVXJsLCAkYmFzZURpciwgJGRlc2lnbkFyZWFbJ29yaWdpbmFsX2ltYWdlJ11bJ3VybCddCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICRzZXR0aW5nc1skaW1hZ2VJZF0gPSAkZGVzaWduQXJlYTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAkdGhpcy0+X3Byb2R1Y3RTZXR0aW5ncyA9ICRzZXR0aW5nczsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICR0aGlzLT5fcHJvZHVjdFNldHRpbmdzOwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBqc29uRGVjb2RlKCRzdHJpbmcpCiAgICB7CiAgICAgICAgJHJlc3VsdCA9IGFycmF5KCk7CiAgICAgICAgaWYgKCRzdHJpbmcpIHsKICAgICAgICAgICAgJHNldHRpbmdzID0gTWFnZTo6aGVscGVyKCdjb3JlJyktPmpzb25EZWNvZGUoJHN0cmluZyk7CiAgICAgICAgICAgIGZvcmVhY2ggKCRzZXR0aW5ncyBhcyAkaSA9PiAkdikgewogICAgICAgICAgICAgICAgJHJlc3VsdFskaV0gPSAoYXJyYXkpJHY7CiAgICAgICAgICAgICAgICBpZiAoIWlzc2V0KCRyZXN1bHRbJGldWydzJ10pKSB7CiAgICAgICAgICAgICAgICAgICAgJHJlc3VsdFskaV1bJ3MnXSA9IDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiAkcmVzdWx0OwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRJbWFnZURpbWVuc2lvbnMoJGltYWdlUGF0aCkKICAgIHsKICAgICAgICAkZGlySW1nID0gTWFnZTo6Z2V0QmFzZURpcigpIC4gc3RyX3JlcGxhY2UoIi8iLCBEUywgc3Ryc3RyKCRpbWFnZVBhdGgsICcvbWVkaWEnKSk7CgogICAgICAgIGlmIChmaWxlX2V4aXN0cygkZGlySW1nKSkgewogICAgICAgICAgICAkaW1hZ2VPYmogPSBuZXcgVmFyaWVuX0ltYWdlKCRkaXJJbWcpOwogICAgICAgICAgICAkd2lkdGggICAgPSAkaW1hZ2VPYmotPmdldE9yaWdpbmFsV2lkdGgoKTsKICAgICAgICAgICAgJGhlaWdodCAgID0gJGltYWdlT2JqLT5nZXRPcmlnaW5hbEhlaWdodCgpOwogICAgICAgICAgICByZXR1cm4gYXJyYXkoJHdpZHRoLCAkaGVpZ2h0KTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBhcnJheSgwLCAwKTsKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gcHJlcGFyZURlc2lnbmVyU2Vzc2lvbklkKCkKICAgIHsKICAgICAgICAkY3VzdG9tZXJTZXNzaW9uID0gJHRoaXMtPl9nZXRDdXN0b21lclNlc3Npb24oKTsKICAgICAgICBpZiAoISRjdXN0b21lclNlc3Npb24tPmdldERlc2lnbmVyU2Vzc2lvbklkKCkpIHsKICAgICAgICAgICAgJGN1c3RvbWVyU2Vzc2lvbi0+c2V0RGVzaWduZXJTZXNzaW9uSWQoc2hhMShyYW5kKDAsIDEwMDApIC4gbWljcm90aW1lKHRydWUpKSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBnZXREZXNpZ25lclNlc3Npb25JZCgpCiAgICB7CiAgICAgICAgJHNlc3Npb25JZCA9ICR0aGlzLT5fZ2V0Q3VzdG9tZXJTZXNzaW9uKCktPmdldEVuY3J5cHRlZFNlc3Npb25JZCgpOwogICAgICAgIHJldHVybiAkc2Vzc2lvbklkOwogICAgfQoKICAgIHByb3RlY3RlZCBmdW5jdGlvbiBfZ2V0Q3VzdG9tZXJTZXNzaW9uKCkKICAgIHsKICAgICAgICByZXR1cm4gTWFnZTo6Z2V0U2luZ2xldG9uKCdjdXN0b21lci9zZXNzaW9uJyk7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGdldERlc2lnbldpZHRoKCkKICAgIHsKICAgICAgICByZXR1cm4gR29NYWdlX1Byb2R1Y3REZXNpZ25lcl9Nb2RlbF9EZXNpZ246OkRFU0lHTl9TSVpFX1dJRFRIOwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBnZXREZXNpZ25IZWlnaHQoKQogICAgewogICAgICAgIHJldHVybiBHb01hZ2VfUHJvZHVjdERlc2lnbmVyX01vZGVsX0Rlc2lnbjo6REVTSUdOX1NJWkVfSEVJR0hUOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIEltYWdlIFVybAogICAgICoKICAgICAqIEBwYXJhbSBNYWdlX0NhdGFsb2dfTW9kZWxfUHJvZHVjdCAkcHJvZHVjdCBQcm9kdWN0CiAgICAgKiBAcGFyYW0gVmFyaWVuX09iamVjdCAkaW1hZ2UgSW1hZ2UKICAgICAqIEBwYXJhbSBhcnJheSAkc2l6ZSBTaXplCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0RGVzaWduSW1hZ2VVcmwoTWFnZV9DYXRhbG9nX01vZGVsX1Byb2R1Y3QgJHByb2R1Y3QsICRpbWFnZSwgJHNpemUgPSBhcnJheSgpKQogICAgewogICAgICAgIGlmIChlbXB0eSgkc2l6ZSkpIHsKICAgICAgICAgICAgJGltYWdlV2lkdGggID0gJHRoaXMtPmdldERlc2lnbldpZHRoKCk7CiAgICAgICAgICAgICRpbWFnZUhlaWdodCA9ICR0aGlzLT5nZXREZXNpZ25IZWlnaHQoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBsaXN0KCRpbWFnZVdpZHRoLCAkaW1hZ2VIZWlnaHQpID0gJHNpemU7CiAgICAgICAgfQoKICAgICAgICAkaW1hZ2VGaWxlID0gaXNfb2JqZWN0KCRpbWFnZSkgPyAkaW1hZ2UtPmdldEZpbGUoKSA6ICRpbWFnZVsnZmlsZSddOwogICAgICAgIHJldHVybiBNYWdlOjpoZWxwZXIoJ2NhdGFsb2cvaW1hZ2UnKQogICAgICAgICAgICAtPmluaXQoJHByb2R1Y3QsICdiYXNlX2ltYWdlJywgJGltYWdlRmlsZSkKICAgICAgICAgICAgLT5rZWVwRnJhbWUoZmFsc2UpCiAgICAgICAgICAgIC0+cmVzaXplKCRpbWFnZVdpZHRoLCAkaW1hZ2VIZWlnaHQpCiAgICAgICAgICAgIC0+X190b1N0cmluZygpOwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRPcmlnaW5hbEltYWdlKE1hZ2VfQ2F0YWxvZ19Nb2RlbF9Qcm9kdWN0ICRwcm9kdWN0LCAkaW1hZ2UpCiAgICB7CiAgICAgICAgJGltYWdlRmlsZSA9IGlzX29iamVjdCgkaW1hZ2UpID8gJGltYWdlLT5nZXRGaWxlKCkgOiAkaW1hZ2VbJ2ZpbGUnXTsKICAgICAgICAkaW1hZ2VQYXRoID0gJHByb2R1Y3QtPmdldE1lZGlhQ29uZmlnKCktPmdldE1lZGlhUGF0aCgkaW1hZ2VGaWxlKTsKICAgICAgICAkbWluV2lkdGggID0gTWFnZTo6Z2V0U3RvcmVDb25maWcoJ2dvbWFnZV9kZXNpZ25lci9nZW5lcmFsL3pvb21fc2l6ZV93aWR0aCcpOwogICAgICAgICRtaW5IZWlnaHQgPSBNYWdlOjpnZXRTdG9yZUNvbmZpZygnZ29tYWdlX2Rlc2lnbmVyL2dlbmVyYWwvem9vbV9zaXplX2hlaWdodCcpOwogICAgICAgIGlmIChmaWxlX2V4aXN0cygkaW1hZ2VQYXRoKSkgewogICAgICAgICAgICAkaW1hZ2VPYmogICA9IG5ldyBWYXJpZW5fSW1hZ2UoJGltYWdlUGF0aCk7CiAgICAgICAgICAgICR3aWR0aCAgICAgID0gJGltYWdlT2JqLT5nZXRPcmlnaW5hbFdpZHRoKCk7CiAgICAgICAgICAgICRoZWlnaHQgICAgID0gJGltYWdlT2JqLT5nZXRPcmlnaW5hbEhlaWdodCgpOwogICAgICAgICAgICAkZGltZW5zaW9ucyA9IGFycmF5KCk7CiAgICAgICAgICAgIGlmICgkd2lkdGggPCAkbWluV2lkdGggJiYgJGhlaWdodCA8ICRtaW5IZWlnaHQpIHsKICAgICAgICAgICAgICAgICRkaW1lbnNpb25zWzBdID0gJG1pbldpZHRoOwogICAgICAgICAgICAgICAgJGRpbWVuc2lvbnNbMV0gPSAkbWluSGVpZ2h0OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJGRpbWVuc2lvbnNbMF0gPSAkd2lkdGg7CiAgICAgICAgICAgICAgICAkZGltZW5zaW9uc1sxXSA9ICRoZWlnaHQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGFycmF5KAogICAgICAgICAgICAgICAgJ3VybCcgICAgICAgID0+ICR0aGlzLT5nZXREZXNpZ25JbWFnZVVybCgkcHJvZHVjdCwgJGltYWdlLCAkZGltZW5zaW9ucyksCiAgICAgICAgICAgICAgICAnZGltZW5zaW9ucycgPT4gJGRpbWVuc2lvbnMKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBhcnJheSgpOwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRQcm9kdWN0U2V0dGluZ0ZvckVkaXRvcihNYWdlX0NhdGFsb2dfTW9kZWxfUHJvZHVjdCAkcHJvZHVjdCA9IG51bGwpCiAgICB7CiAgICAgICAgaWYgKCEkdGhpcy0+X2VkaXRvckNvbmZpZykgewogICAgICAgICAgICBpZiAoaXNfbnVsbCgkcHJvZHVjdCkpIHsKICAgICAgICAgICAgICAgICRwcm9kdWN0ID0gTWFnZTo6cmVnaXN0cnkoJ3Byb2R1Y3QnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJGVkaXRvckNvbmZpZyA9IGFycmF5KAogICAgICAgICAgICAgICAgJ2ltYWdlcycgPT4gYXJyYXkoKQogICAgICAgICAgICApOwoKICAgICAgICAgICAgaWYgKCEkcHJvZHVjdC0+Z2V0SWQoKSkgewogICAgICAgICAgICAgICAgcmV0dXJuICRlZGl0b3JDb25maWc7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRpbWFnZXMgPSAkcHJvZHVjdC0+Z2V0TWVkaWFHYWxsZXJ5SW1hZ2VzKCk7CgogICAgICAgICAgICAkY29sb3JBdHRyaWJ1dGVDb2RlID0gTWFnZTo6Z2V0U3RvcmVDb25maWcoJ2dvbWFnZV9kZXNpZ25lci9uYXZpZ2F0aW9uL2NvbG9yX2F0dHJpYnV0ZScpOwogICAgICAgICAgICAkZGVmYXVsdENvbG9yICAgICAgID0gbnVsbDsKICAgICAgICAgICAgZm9yZWFjaCAoJGltYWdlcyBhcyAkaW1hZ2UpIHsKICAgICAgICAgICAgICAgICRpZCAgICAgICA9ICRpbWFnZVsndmFsdWVfaWQnXTsKICAgICAgICAgICAgICAgIGlmICgkaW1hZ2VbJ2Rlc2lnbl9hcmVhJ10pIHsKICAgICAgICAgICAgICAgICAgICAkc2V0dGluZ3MgPSBNYWdlOjpoZWxwZXIoJ2NvcmUnKS0+anNvbkRlY29kZSgkaW1hZ2VbJ2Rlc2lnbl9hcmVhJ10pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCFpc3NldCgkc2V0dGluZ3MpIHx8ICEkc2V0dGluZ3MgfHwgZW1wdHkoJHNldHRpbmdzKSkgewogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJGltYWdlVXJsICAgICAgICAgICA9ICR0aGlzLT5nZXREZXNpZ25JbWFnZVVybCgkcHJvZHVjdCwgJGltYWdlKTsKICAgICAgICAgICAgICAgICRjb25mICAgICAgICAgICAgICAgPSAkc2V0dGluZ3M7CiAgICAgICAgICAgICAgICAkY29uZlsnaWQnXSAgICAgICAgID0gJGlkOwogICAgICAgICAgICAgICAgJGNvbmZbJ3UnXSAgICAgICAgICA9ICRpbWFnZVVybDsKICAgICAgICAgICAgICAgICRjb25mWydkJ10gICAgICAgICAgPSAkdGhpcy0+Z2V0SW1hZ2VEaW1lbnNpb25zKCRpbWFnZVVybCk7CiAgICAgICAgICAgICAgICAkY29uZlsnb3JpZ19pbWFnZSddID0gJHRoaXMtPmdldE9yaWdpbmFsSW1hZ2UoJHByb2R1Y3QsICRpbWFnZSk7CiAgICAgICAgICAgICAgICAkY29uZlsnaWNvJ10gICAgICAgID0gJHRoaXMtPmdldERlc2lnbkltYWdlVXJsKCRwcm9kdWN0LCAkaW1hZ2UsIGFycmF5KDYwLCA2MCkpOwogICAgICAgICAgICAgICAgJGNvbmZbJ2NhbnZhc19iYWNrZ3JvdW5kX3VybCddID0gJGltYWdlLT5nZXRDYW52YXNCYWNrZ3JvdW5kRmlsZSgpID8KICAgICAgICAgICAgICAgICAgICBNYWdlOjpnZXRTaW5nbGV0b24oJ2dvbWFnZV9kZXNpZ25lci9DYW52YXNCYWNrZ3JvdW5kSW1hZ2VfZ2FsbGVyeV9jb25maWcnKQogICAgICAgICAgICAgICAgICAgICAgICAtPmdldEJhc2VNZWRpYVVybCgpIC4gRFMgLiAkaW1hZ2UtPmdldENhbnZhc0JhY2tncm91bmRGaWxlKCkKICAgICAgICAgICAgICAgICAgICA6IG51bGw7CgogICAgICAgICAgICAgICAgaWYgKCRwcm9kdWN0LT5nZXRUeXBlSWQoKSA9PSBNYWdlX0NhdGFsb2dfTW9kZWxfUHJvZHVjdF9UeXBlOjpUWVBFX0NPTkZJR1VSQUJMRSkgewogICAgICAgICAgICAgICAgICAgIGlmICgkaW1hZ2VbJ2NvbG9yJ10pIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzX251bGwoJGRlZmF1bHRDb2xvcikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkZWZhdWx0Q29sb3IgPSAkaW1hZ2VbJ2NvbG9yJ107CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFpc3NldCgkZWRpdG9yQ29uZmlnWydpbWFnZXMnXVskaW1hZ2VbJ2NvbG9yJ11dKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGVkaXRvckNvbmZpZ1snaW1hZ2VzJ11bJGltYWdlWydjb2xvciddXSA9IGFycmF5KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgJGVkaXRvckNvbmZpZ1snaW1hZ2VzJ11bJGltYWdlWydjb2xvciddXVskaWRdID0gJGNvbmY7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGRlZmF1bHRDb2xvciAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA9ICRwcm9kdWN0LT5nZXREYXRhKCRjb2xvckF0dHJpYnV0ZUNvZGUpID86ICdub25lX2NvbG9yJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGVkaXRvckNvbmZpZ1snaW1hZ2VzJ11bJGRlZmF1bHRDb2xvcl1bJGlkXSA9ICRjb25mOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJGRlZmF1bHRDb2xvciAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA9ICdub25lX2NvbG9yJzsKICAgICAgICAgICAgICAgICAgICAkZWRpdG9yQ29uZmlnWydpbWFnZXMnXVskZGVmYXVsdENvbG9yXVskaWRdID0gJGNvbmY7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkZWRpdG9yQ29uZmlnWydkZWZhdWx0X2NvbG9yJ10gPSAkZGVmYXVsdENvbG9yOwogICAgICAgICAgICAgICAgJGVkaXRvckNvbmZpZ1sndXJsJ10gICAgICAgICAgID0gJHByb2R1Y3QtPmdldFByb2R1Y3RVcmwoKTsKICAgICAgICAgICAgICAgICRlZGl0b3JDb25maWdbJ25hbWUnXSAgICAgICAgICA9ICRwcm9kdWN0LT5nZXROYW1lKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICR0aGlzLT5fZWRpdG9yQ29uZmlnID0gJGVkaXRvckNvbmZpZzsKICAgICAgICB9CgogICAgICAgIHJldHVybiAkdGhpcy0+X2VkaXRvckNvbmZpZzsKICAgIH0KCiAgICAvKioKICAgICAqIFNhdmUgcHJvZHVjdCBkZXNpZ24gaW1hZ2VzCiAgICAgKgogICAgICogQHJldHVybiBHb01hZ2VfUHJvZHVjdERlc2lnbmVyX01vZGVsX0Rlc2lnbgogICAgICogQHRocm93cyBFeGNlcHRpb24KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHNhdmVQcm9kdWN0RGVzaWduZWRJbWFnZXMoKQogICAgewogICAgICAgICRwcm9kdWN0ID0gJHRoaXMtPmluaXRpYWxpemVQcm9kdWN0KCk7CiAgICAgICAgJGltYWdlcyAgPSBNYWdlOjphcHAoKS0+Z2V0UmVxdWVzdCgpLT5nZXRQYXJhbSgnaW1hZ2VzJyk7CiAgICAgICAgaWYgKCRwcm9kdWN0LT5nZXRJZCgpICYmICRpbWFnZXMgJiYgIWVtcHR5KCRpbWFnZXMpKSB7CiAgICAgICAgICAgICRkZXNpZ24gPSBNYWdlOjpnZXRNb2RlbCgnZ29tYWdlX2Rlc2lnbmVyL2Rlc2lnbicpLT5zYXZlRGVzaWduKCRwcm9kdWN0LCAkdGhpcy0+X2dldFJlcXVlc3QoKS0+Z2V0UGFyYW1zKCkpOwogICAgICAgICAgICByZXR1cm4gJGRlc2lnbjsKICAgICAgICB9IGVsc2VpZiAoISRwcm9kdWN0LT5nZXRJZCgpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRpb24oTWFnZTo6aGVscGVyKCdnb21hZ2VfZGVzaWduZXInKS0+X18oJ1Byb2R1Y3QgaXMgbm90IGRlZmluZWQnKSk7CiAgICAgICAgfSBlbHNlaWYgKCEkaW1hZ2VzIHx8IGVtcHR5KCRpbWFnZXMpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRpb24oTWFnZTo6aGVscGVyKCdnb21hZ2VfZGVzaWduZXInKS0+X18oJ0Rlc2lnbmVkIGltYWdlcyBhcmUgZW1wdHknKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogSW5pdGlhbGl6ZSBjdXJyZW50IHByb2R1Y3QgZnJvbSByZXF1ZXN0CiAgICAgKgogICAgICogQHJldHVybiBNYWdlX0NhdGFsb2dfTW9kZWxfUHJvZHVjdAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gaW5pdGlhbGl6ZVByb2R1Y3QoKQogICAgewogICAgICAgICRwcm9kdWN0ID0gTWFnZTo6cmVnaXN0cnkoJ3Byb2R1Y3QnKTsKICAgICAgICBpZiAoJHByb2R1Y3QpIHsKICAgICAgICAgICAgcmV0dXJuICRwcm9kdWN0OwogICAgICAgIH0KICAgICAgICAkcmVxdWVzdCAgID0gTWFnZTo6YXBwKCktPmdldFJlcXVlc3QoKTsKICAgICAgICAkcHJvZHVjdElkID0gJHJlcXVlc3QtPmdldFBhcmFtKCJpZCIsIGZhbHNlKTsKCiAgICAgICAgJHByb2R1Y3QgPSBNYWdlOjpnZXRNb2RlbCgnY2F0YWxvZy9wcm9kdWN0Jyk7CiAgICAgICAgaWYgKCRwcm9kdWN0SWQpIHsKICAgICAgICAgICAgJHByb2R1Y3QtPmxvYWQoJHByb2R1Y3RJZCk7CiAgICAgICAgfQogICAgICAgIE1hZ2U6OnJlZ2lzdGVyKCdwcm9kdWN0JywgJHByb2R1Y3QpOwoKICAgICAgICByZXR1cm4gJHByb2R1Y3Q7CiAgICB9CgogICAgLyoqCiAgICAgKiBQcmljZSBjYWxjdWxhdGlvbiBkZXBlbmRpbmcgb24gcHJvZHVjdCBvcHRpb25zCiAgICAgKgogICAgICogQHJldHVybiBhcnJheQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0UHJvZHVjdFByaWNlQ29uZmlnKCkKICAgIHsKICAgICAgICAkY29uZmlnICAgPSBhcnJheSgpOwogICAgICAgICRfcmVxdWVzdCA9IE1hZ2U6OmdldFNpbmdsZXRvbigndGF4L2NhbGN1bGF0aW9uJyktPmdldFJhdGVSZXF1ZXN0KGZhbHNlLCBmYWxzZSwgZmFsc2UpOwogICAgICAgIC8qIEB2YXIgJHByb2R1Y3QgTWFnZV9DYXRhbG9nX01vZGVsX1Byb2R1Y3QgKi8KICAgICAgICAkcHJvZHVjdCA9ICR0aGlzLT5pbml0aWFsaXplUHJvZHVjdCgpOwogICAgICAgICRfcmVxdWVzdC0+c2V0UHJvZHVjdENsYXNzSWQoJHByb2R1Y3QtPmdldFRheENsYXNzSWQoKSk7CiAgICAgICAgJGRlZmF1bHRUYXggPSBNYWdlOjpnZXRTaW5nbGV0b24oJ3RheC9jYWxjdWxhdGlvbicpLT5nZXRSYXRlKCRfcmVxdWVzdCk7CgogICAgICAgICRfcmVxdWVzdCA9IE1hZ2U6OmdldFNpbmdsZXRvbigndGF4L2NhbGN1bGF0aW9uJyktPmdldFJhdGVSZXF1ZXN0KCk7CiAgICAgICAgJF9yZXF1ZXN0LT5zZXRQcm9kdWN0Q2xhc3NJZCgkcHJvZHVjdC0+Z2V0VGF4Q2xhc3NJZCgpKTsKICAgICAgICAkY3VycmVudFRheCA9IE1hZ2U6OmdldFNpbmdsZXRvbigndGF4L2NhbGN1bGF0aW9uJyktPmdldFJhdGUoJF9yZXF1ZXN0KTsKCiAgICAgICAgJF9yZWd1bGFyUHJpY2UgICAgICA9ICRwcm9kdWN0LT5nZXRQcmljZSgpOwogICAgICAgICRfZmluYWxQcmljZSAgICAgICAgPSAkcHJvZHVjdC0+Z2V0RmluYWxQcmljZSgpOwogICAgICAgICRfcHJpY2VJbmNsVGF4ICAgICAgPSBNYWdlOjpoZWxwZXIoJ3RheCcpLT5nZXRQcmljZSgkcHJvZHVjdCwgJF9maW5hbFByaWNlLCB0cnVlKTsKICAgICAgICAkX3ByaWNlRXhjbFRheCAgICAgID0gTWFnZTo6aGVscGVyKCd0YXgnKS0+Z2V0UHJpY2UoJHByb2R1Y3QsICRfZmluYWxQcmljZSk7CiAgICAgICAgJF90aWVyUHJpY2VzICAgICAgICA9IGFycmF5KCk7CiAgICAgICAgJF90aWVyUHJpY2VzSW5jbFRheCA9IGFycmF5KCk7CiAgICAgICAgZm9yZWFjaCAoJHByb2R1Y3QtPmdldFRpZXJQcmljZSgpIGFzICR0aWVyUHJpY2UpIHsKICAgICAgICAgICAgJF90aWVyUHJpY2VzW10gICAgICAgID0gTWFnZTo6aGVscGVyKCdjb3JlJyktPmN1cnJlbmN5KCR0aWVyUHJpY2VbJ3dlYnNpdGVfcHJpY2UnXSwgZmFsc2UsIGZhbHNlKTsKICAgICAgICAgICAgJF90aWVyUHJpY2VzSW5jbFRheFtdID0gTWFnZTo6aGVscGVyKCdjb3JlJyktPmN1cnJlbmN5KAogICAgICAgICAgICAgICAgTWFnZTo6aGVscGVyKCd0YXgnKS0+Z2V0UHJpY2UoJHByb2R1Y3QsIChpbnQpJHRpZXJQcmljZVsnd2Vic2l0ZV9wcmljZSddLCB0cnVlKSwKICAgICAgICAgICAgICAgIGZhbHNlLCBmYWxzZQogICAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICAkY29uZmlnID0gYXJyYXkoCiAgICAgICAgICAgICdwcm9kdWN0SWQnICAgICAgICAgICA9PiAkcHJvZHVjdC0+Z2V0SWQoKSwKICAgICAgICAgICAgJ3ByaWNlRm9ybWF0JyAgICAgICAgID0+IE1hZ2U6OmFwcCgpLT5nZXRMb2NhbGUoKS0+Z2V0SnNQcmljZUZvcm1hdCgpLAogICAgICAgICAgICAnaW5jbHVkZVRheCcgICAgICAgICAgPT4gTWFnZTo6aGVscGVyKCd0YXgnKS0+cHJpY2VJbmNsdWRlc1RheCgpID8gJ3RydWUnIDogJ2ZhbHNlJywKICAgICAgICAgICAgJ3Nob3dJbmNsdWRlVGF4JyAgICAgID0+IE1hZ2U6OmhlbHBlcigndGF4JyktPmRpc3BsYXlQcmljZUluY2x1ZGluZ1RheCgpLAogICAgICAgICAgICAnc2hvd0JvdGhQcmljZXMnICAgICAgPT4gTWFnZTo6aGVscGVyKCd0YXgnKS0+ZGlzcGxheUJvdGhQcmljZXMoKSwKICAgICAgICAgICAgJ3Byb2R1Y3RQcmljZScgICAgICAgID0+IE1hZ2U6OmhlbHBlcignY29yZScpLT5jdXJyZW5jeSgkX2ZpbmFsUHJpY2UsIGZhbHNlLCBmYWxzZSksCiAgICAgICAgICAgICdwcm9kdWN0T2xkUHJpY2UnICAgICA9PiBNYWdlOjpoZWxwZXIoJ2NvcmUnKS0+Y3VycmVuY3koJF9yZWd1bGFyUHJpY2UsIGZhbHNlLCBmYWxzZSksCiAgICAgICAgICAgICdwcmljZUluY2xUYXgnICAgICAgICA9PiBNYWdlOjpoZWxwZXIoJ2NvcmUnKS0+Y3VycmVuY3koJF9wcmljZUluY2xUYXgsIGZhbHNlLCBmYWxzZSksCiAgICAgICAgICAgICdwcmljZUV4Y2xUYXgnICAgICAgICA9PiBNYWdlOjpoZWxwZXIoJ2NvcmUnKS0+Y3VycmVuY3koJF9wcmljZUV4Y2xUYXgsIGZhbHNlLCBmYWxzZSksCiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBAdmFyIHNraXBDYWxjdWxhdGUKICAgICAgICAgICAgICogQGRlcHJlY2F0ZWQgYWZ0ZXIgMS41LjEuMAogICAgICAgICAgICAgKi8KICAgICAgICAgICAgJ3NraXBDYWxjdWxhdGUnICAgICAgID0+ICgkX3ByaWNlRXhjbFRheCAhPSAkX3ByaWNlSW5jbFRheCA/IDAgOiAxKSwKICAgICAgICAgICAgJ2RlZmF1bHRUYXgnICAgICAgICAgID0+ICRkZWZhdWx0VGF4LAogICAgICAgICAgICAnY3VycmVudFRheCcgICAgICAgICAgPT4gJGN1cnJlbnRUYXgsCiAgICAgICAgICAgICdpZFN1ZmZpeCcgICAgICAgICAgICA9PiAnX2Nsb25lJywKICAgICAgICAgICAgJ29sZFBsdXNEaXNwb3NpdGlvbicgID0+IDAsCiAgICAgICAgICAgICdwbHVzRGlzcG9zaXRpb24nICAgICA9PiAwLAogICAgICAgICAgICAncGx1c0Rpc3Bvc2l0aW9uVGF4JyAgPT4gMCwKICAgICAgICAgICAgJ29sZE1pbnVzRGlzcG9zaXRpb24nID0+IDAsCiAgICAgICAgICAgICdtaW51c0Rpc3Bvc2l0aW9uJyAgICA9PiAwLAogICAgICAgICAgICAndGllclByaWNlcycgICAgICAgICAgPT4gJF90aWVyUHJpY2VzLAogICAgICAgICAgICAndGllclByaWNlc0luY2xUYXgnICAgPT4gJF90aWVyUHJpY2VzSW5jbFRheCwKICAgICAgICApOwoKICAgICAgICAkcmVzcG9uc2VPYmplY3QgPSBuZXcgVmFyaWVuX09iamVjdCgpOwogICAgICAgIE1hZ2U6OmRpc3BhdGNoRXZlbnQoJ2NhdGFsb2dfcHJvZHVjdF92aWV3X2NvbmZpZycsIGFycmF5KCdyZXNwb25zZV9vYmplY3QnID0+ICRyZXNwb25zZU9iamVjdCkpOwogICAgICAgIGlmIChpc19hcnJheSgkcmVzcG9uc2VPYmplY3QtPmdldEFkZGl0aW9uYWxPcHRpb25zKCkpKSB7CiAgICAgICAgICAgIGZvcmVhY2ggKCRyZXNwb25zZU9iamVjdC0+Z2V0QWRkaXRpb25hbE9wdGlvbnMoKSBhcyAkb3B0aW9uID0+ICR2YWx1ZSkgewogICAgICAgICAgICAgICAgJGNvbmZpZ1skb3B0aW9uXSA9ICR2YWx1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICRjb25maWc7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGZvcm1hdEZpbGVOYW1lKCRmaWxlKQogICAgewogICAgICAgICRmb3JtYXRSZXN1bHQgPSBNYWdlOjpoZWxwZXIoJ2NhdGFsb2cvcHJvZHVjdF91cmwnKS0+Zm9ybWF0KCRmaWxlKTsKICAgICAgICByZXR1cm4gcHJlZ19yZXBsYWNlKCcjW1xzXSsjaScsICctJywgJGZvcm1hdFJlc3VsdCk7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGNhbkFwcGx5TXNycCgkcHJvZHVjdCwgJHZpc2liaWxpdHkgPSBudWxsLCAkY2hlY2tBc3NvY2lhdGVkSXRlbXMgPSB0cnVlKQogICAgewogICAgICAgICR2ZXJzaW9uID0gTWFnZTo6Z2V0VmVyc2lvbkluZm8oKTsKICAgICAgICBpZiAoKCR2ZXJzaW9uWydtYWpvciddID09PSAnMScpICYmICgoaW50KSR2ZXJzaW9uWydtaW5vciddIDw9IDUpKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9IGVsc2VpZiAobWV0aG9kX2V4aXN0cyhNYWdlOjpoZWxwZXIoJ2NhdGFsb2cnKSwgJ2NhbkFwcGx5TXNycCcpKSB7CiAgICAgICAgICAgIHJldHVybiBNYWdlOjpoZWxwZXIoJ2NhdGFsb2cnKS0+Y2FuQXBwbHlNc3JwKCRwcm9kdWN0LCAkdmlzaWJpbGl0eSwgJGNoZWNrQXNzb2NpYXRlZEl0ZW1zKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHJpZXZlIHVybCBmb3IgYWRkaW5nIHByb2R1Y3QgdG8gd2lzaGxpc3QKICAgICAqCiAgICAgKiBAcGFyYW0gaW50ICRpdGVtSWQKICAgICAqCiAgICAgKiBAcmV0dXJuICBzdHJpbmcKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldE1vdmVGcm9tQ2FydFVybCgkaXRlbUlkKQogICAgewogICAgICAgICR2ZXJzaW9uID0gTWFnZTo6Z2V0VmVyc2lvbkluZm8oKTsKICAgICAgICBpZiAoKCR2ZXJzaW9uWydtYWpvciddID09PSAnMScpICYmICgoaW50KSR2ZXJzaW9uWydtaW5vciddIDw9IDUpKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAobWV0aG9kX2V4aXN0cyhNYWdlOjpoZWxwZXIoJ3dpc2hsaXN0JyksICdnZXRNb3ZlRnJvbUNhcnRVcmwnKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIE1hZ2U6OmhlbHBlcignd2lzaGxpc3QnKS0+Z2V0TW92ZUZyb21DYXJ0VXJsKCRpdGVtSWQpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgSlNPTiBlbmNvZGVkIGNvbmZpZ3VyYXRpb24gYXJyYXkgd2hpY2ggY2FuIGJlIHVzZWQgZm9yIEpTIGR5bmFtaWMKICAgICAqCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0UHJvZHVjdFByaWNlQ29uZmlnSnNvbigpCiAgICB7CiAgICAgICAgcmV0dXJuIE1hZ2U6OmhlbHBlcignY29yZScpLT5qc29uRW5jb2RlKCR0aGlzLT5nZXRQcm9kdWN0UHJpY2VDb25maWcoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gcHJvZHVjdCBkZXNpZ24gZnJvbSByZXF1ZXN0CiAgICAgKgogICAgICogQHBhcmFtIE1hZ2VfQ2F0YWxvZ19Nb2RlbF9Qcm9kdWN0ICRwcm9kdWN0IFByb2R1Y3QKICAgICAqIEByZXR1cm4gYm9vbHxNYWdlX0NvcmVfTW9kZWxfQWJzdHJhY3QKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldFByb2R1Y3REZXNpZ24oJHByb2R1Y3QpCiAgICB7CiAgICAgICAgaWYgKGlzX251bGwoJHRoaXMtPl9wcm9kdWN0RGVzaWduKSkgewogICAgICAgICAgICAkZGVzaWduSWQgPSAoaW50KU1hZ2U6OmFwcCgpLT5nZXRSZXF1ZXN0KCktPmdldFBhcmFtKCdkZXNpZ25faWQnLCBmYWxzZSk7CiAgICAgICAgICAgIGlmICgkZGVzaWduSWQpIHsKICAgICAgICAgICAgICAgICRkZXNpZ24gPSBNYWdlOjpnZXRNb2RlbCgnZ29tYWdlX2Rlc2lnbmVyL2Rlc2lnbicpLT5sb2FkKCRkZXNpZ25JZCk7CiAgICAgICAgICAgICAgICBpZiAoJGRlc2lnbi0+Z2V0SWQoKSAmJiAkZGVzaWduLT5nZXRQcm9kdWN0SWQoKSA9PSAkcHJvZHVjdC0+Z2V0SWQoKSkgewogICAgICAgICAgICAgICAgICAgICR0aGlzLT5fcHJvZHVjdERlc2lnbiA9ICRkZXNpZ247CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICR0aGlzLT5fcHJvZHVjdERlc2lnbiA9IGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJHRoaXMtPl9wcm9kdWN0RGVzaWduOwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRBbGxTdG9yZURvbWFpbnMoKQogICAgewogICAgICAgICRkb21haW5zID0gYXJyYXkoKTsKICAgICAgICBmb3JlYWNoIChNYWdlOjphcHAoKS0+Z2V0V2Vic2l0ZXMoKSBhcyAkd2Vic2l0ZSkgewogICAgICAgICAgICAkdXJsID0gJHdlYnNpdGUtPmdldENvbmZpZygnd2ViL3Vuc2VjdXJlL2Jhc2VfdXJsJyk7CiAgICAgICAgICAgIGlmICgkZG9tYWluID0gdHJpbShwcmVnX3JlcGxhY2UoJy9eLio/XFwvXFwvKC4qKT9cXC8vJywgJyQxJywgJHVybCkpKSB7CiAgICAgICAgICAgICAgICAkZG9tYWluc1tdID0gJGRvbWFpbjsKICAgICAgICAgICAgfQogICAgICAgICAgICAkdXJsID0gJHdlYnNpdGUtPmdldENvbmZpZygnd2ViL3NlY3VyZS9iYXNlX3VybCcpOwoKICAgICAgICAgICAgaWYgKCRkb21haW4gPSB0cmltKHByZWdfcmVwbGFjZSgnL14uKj9cXC9cXC8oLiopP1xcLy8nLCAnJDEnLCAkdXJsKSkpIHsKICAgICAgICAgICAgICAgICRkb21haW5zW10gPSAkZG9tYWluOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gYXJyYXlfdW5pcXVlKCRkb21haW5zKTsKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0V2luZG93Q3NzUGF0aCgpCiAgICB7CiAgICAgICAgaWYgKCEkdGhpcy0+Z2V0SXNBbnltb3JlVmVyc2lvbigxLCA3KSkgewogICAgICAgICAgICByZXR1cm4gJ3Byb3RvdHlwZS93aW5kb3dzL3RoZW1lcy9tYWdlbnRvLmNzcyc7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuICdsaWIvcHJvdG90eXBlL3dpbmRvd3MvdGhlbWVzL21hZ2VudG8uY3NzJzsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGdldENzc1R5cGUoKQogICAgewogICAgICAgIGlmICghJHRoaXMtPmdldElzQW55bW9yZVZlcnNpb24oMSwgNykpIHsKICAgICAgICAgICAgcmV0dXJuICdqc19jc3MnOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiAnc2tpbl9jc3MnOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0QXZhaWxhYmxlV2Vic2l0ZXMoKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+X3coKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gX3coKQogICAgewogICAgICAgIGlmICghTWFnZTo6Z2V0U3RvcmVDb25maWcoJ2dvbWFnZV9hY3RpdmF0aW9uL2Rlc2lnbmVyL2luc3RhbGxlZCcpIHx8CiAgICAgICAgICAgIChpbnR2YWwoTWFnZTo6Z2V0U3RvcmVDb25maWcoJ2dvbWFnZV9hY3RpdmF0aW9uL2Rlc2lnbmVyL2NvdW50JykpID4gMTApCiAgICAgICAgKSB7CiAgICAgICAgICAgIHJldHVybiBhcnJheSgpOwogICAgICAgIH0KCiAgICAgICAgJHRpbWVfdG9fdXBkYXRlID0gNjAgKiA2MCAqIDI0ICogMTU7CgogICAgICAgICRyID0gTWFnZTo6Z2V0U3RvcmVDb25maWcoJ2dvbWFnZV9hY3RpdmF0aW9uL2Rlc2lnbmVyL2FyJyk7CiAgICAgICAgJHQgPSBNYWdlOjpnZXRTdG9yZUNvbmZpZygnZ29tYWdlX2FjdGl2YXRpb24vZGVzaWduZXIvdGltZScpOwogICAgICAgICRzID0gTWFnZTo6Z2V0U3RvcmVDb25maWcoJ2dvbWFnZV9hY3RpdmF0aW9uL2Rlc2lnbmVyL3dlYnNpdGVzJyk7CgogICAgICAgICRsYXN0X2NoZWNrID0gc3RyX3JlcGxhY2UoJHIsICcnLCBNYWdlOjpoZWxwZXIoJ2NvcmUnKS0+ZGVjcnlwdCgkdCkpOwoKICAgICAgICAkYWxsc2l0ZXMgPSBleHBsb2RlKCcsJywgc3RyX3JlcGxhY2UoJHIsICcnLCBNYWdlOjpoZWxwZXIoJ2NvcmUnKS0+ZGVjcnlwdCgkcykpKTsKICAgICAgICAkYWxsc2l0ZXMgPSBhcnJheV9kaWZmKCRhbGxzaXRlcywgYXJyYXkoIiIpKTsKCiAgICAgICAgaWYgKCgkbGFzdF9jaGVjayArICR0aW1lX3RvX3VwZGF0ZSkgPCB0aW1lKCkpIHsKICAgICAgICAgICAgJHRoaXMtPmEoTWFnZTo6Z2V0U3RvcmVDb25maWcoJ2dvbWFnZV9hY3RpdmF0aW9uL2Rlc2lnbmVyL2tleScpLAogICAgICAgICAgICAgICAgaW50dmFsKE1hZ2U6OmdldFN0b3JlQ29uZmlnKCdnb21hZ2VfYWN0aXZhdGlvbi9kZXNpZ25lci9jb3VudCcpKSwKICAgICAgICAgICAgICAgIGltcGxvZGUoJywnLCAkYWxsc2l0ZXMpCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJGFsbHNpdGVzOwoKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gYSgkaywgJGMgPSAwLCAkcyA9ICcnKQogICAgewogICAgICAgICRjaCA9IGN1cmxfaW5pdCgpOwogICAgICAgIGN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9VUkwsIHNwcmludGYoJ2h0dHBzOi8vd3d3LmdvbWFnZS5jb20vaW5kZXgucGhwL2dvbWFnZV9kb3dubG9hZGFibGUva2V5L2NoZWNrJykpOwogICAgICAgIGN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9QT1NULCB0cnVlKTsKICAgICAgICBjdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfUE9TVEZJRUxEUywgJ2tleT0nIC4gdXJsZW5jb2RlKCRrKSAuICcmc2t1PXByb2R1Y3QtZGVzaWduZXImZG9tYWlucz0nIC4gdXJsZW5jb2RlKGltcGxvZGUoJywnLCAkdGhpcy0+Z2V0QWxsU3RvcmVEb21haW5zKCkpKSAuICcmdmVyPScgLiB1cmxlbmNvZGUoJzIuNC4wJykpOwogICAgICAgIGN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9USU1FT1VULCAzMCk7CiAgICAgICAgY3VybF9zZXRvcHQoJGNoLCBDVVJMT1BUX1JFVFVSTlRSQU5TRkVSLCB0cnVlKTsKCiAgICAgICAgY3VybF9zZXRvcHQoJGNoLCBDVVJMT1BUX1NTTF9WRVJJRllQRUVSLCAwKTsKICAgICAgICBjdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfU1NMX1ZFUklGWUhPU1QsIDApOwoKICAgICAgICAkY29udGVudCA9IGN1cmxfZXhlYygkY2gpOwoKICAgICAgICB0cnkgewogICAgICAgICAgICAkciA9IFplbmRfSnNvbjo6ZGVjb2RlKCRjb250ZW50KTsKICAgICAgICB9IGNhdGNoIChcRXhjZXB0aW9uICRlKSB7CiAgICAgICAgICAgICRyID0gYXJyYXkoKTsKICAgICAgICB9CgogICAgICAgICRlID0gTWFnZTo6aGVscGVyKCdjb3JlJyk7CiAgICAgICAgaWYgKGVtcHR5KCRyKSkgewoKICAgICAgICAgICAgJHZhbHVlMSA9IE1hZ2U6OmdldFN0b3JlQ29uZmlnKCdnb21hZ2VfYWN0aXZhdGlvbi9kZXNpZ25lci9hcicpOwoKICAgICAgICAgICAgJGdyb3VwcyA9IGFycmF5KAogICAgICAgICAgICAgICAgJ2Rlc2lnbmVyJyA9PiBhcnJheSgKICAgICAgICAgICAgICAgICAgICAnZmllbGRzJyA9PiBhcnJheSgKICAgICAgICAgICAgICAgICAgICAgICAgJ2FyJyAgICAgICA9PiBhcnJheSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICd2YWx1ZScgPT4gJHZhbHVlMQogICAgICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgICAgICAnd2Vic2l0ZXMnID0+IGFycmF5KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3ZhbHVlJyA9PiAoc3RyaW5nKU1hZ2U6OmdldFN0b3JlQ29uZmlnKCdnb21hZ2VfYWN0aXZhdGlvbi9kZXNpZ25lci93ZWJzaXRlcycpCiAgICAgICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgICAgICd0aW1lJyAgICAgPT4gYXJyYXkoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAndmFsdWUnID0+IChzdHJpbmcpJGUtPmVuY3J5cHQoJHZhbHVlMSAuICh0aW1lKCkgLSAoNjAgKiA2MCAqIDI0ICogMTUgLSAxODAwKSkgLiAkdmFsdWUxKQogICAgICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgICAgICAnY291bnQnICAgID0+IGFycmF5KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3ZhbHVlJyA9PiAkYyArIDEpCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICApOwoKICAgICAgICAgICAgTWFnZTo6Z2V0TW9kZWwoJ2FkbWluaHRtbC9jb25maWdfZGF0YScpCiAgICAgICAgICAgICAgICAtPnNldFNlY3Rpb24oJ2dvbWFnZV9hY3RpdmF0aW9uJykKICAgICAgICAgICAgICAgIC0+c2V0R3JvdXBzKCRncm91cHMpCiAgICAgICAgICAgICAgICAtPnNhdmUoKTsKCiAgICAgICAgICAgIE1hZ2U6OmdldENvbmZpZygpLT5yZWluaXQoKTsKICAgICAgICAgICAgTWFnZTo6YXBwKCktPnJlaW5pdFN0b3JlcygpOwoKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgJHZhbHVlMSA9ICcnOwogICAgICAgICR2YWx1ZTIgPSAnJzsKCiAgICAgICAgaWYgKGlzc2V0KCRyWydkJ10pICYmIGlzc2V0KCRyWydjJ10pKSB7CiAgICAgICAgICAgICR2YWx1ZTEgPSAkZS0+ZW5jcnlwdChiYXNlNjRfZW5jb2RlKFplbmRfSnNvbjo6ZW5jb2RlKCRyKSkpOwoKCiAgICAgICAgICAgIGlmICghJHMpIHsKICAgICAgICAgICAgICAgICRzID0gTWFnZTo6Z2V0U3RvcmVDb25maWcoJ2dvbWFnZV9hY3RpdmF0aW9uL2Rlc2lnbmVyL3dlYnNpdGVzJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRzID0gYXJyYXlfc2xpY2UoZXhwbG9kZSgnLCcsICRzKSwgMCwgJHJbJ2MnXSk7CgogICAgICAgICAgICAkdmFsdWUyID0gJGUtPmVuY3J5cHQoJHZhbHVlMSAuIGltcGxvZGUoJywnLCAkcykgLiAkdmFsdWUxKTsKCiAgICAgICAgfQogICAgICAgICRncm91cHMgPSBhcnJheSgKICAgICAgICAgICAgJ2Rlc2lnbmVyJyA9PiBhcnJheSgKICAgICAgICAgICAgICAgICdmaWVsZHMnID0+IGFycmF5KAogICAgICAgICAgICAgICAgICAgICdhcicgICAgICAgID0+IGFycmF5KAogICAgICAgICAgICAgICAgICAgICAgICAndmFsdWUnID0+ICR2YWx1ZTEKICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgICd3ZWJzaXRlcycgID0+IGFycmF5KAogICAgICAgICAgICAgICAgICAgICAgICAndmFsdWUnID0+IChzdHJpbmcpJHZhbHVlMgogICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgJ3RpbWUnICAgICAgPT4gYXJyYXkoCiAgICAgICAgICAgICAgICAgICAgICAgICd2YWx1ZScgPT4gKHN0cmluZykkZS0+ZW5jcnlwdCgkdmFsdWUxIC4gdGltZSgpIC4gJHZhbHVlMSkKICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgICdpbnN0YWxsZWQnID0+IGFycmF5KAogICAgICAgICAgICAgICAgICAgICAgICAndmFsdWUnID0+IDEKICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgICdjb3VudCcgICAgID0+IGFycmF5KAogICAgICAgICAgICAgICAgICAgICAgICAndmFsdWUnID0+IDApCgogICAgICAgICAgICAgICAgKQogICAgICAgICAgICApCiAgICAgICAgKTsKCiAgICAgICAgTWFnZTo6Z2V0TW9kZWwoJ2FkbWluaHRtbC9jb25maWdfZGF0YScpCiAgICAgICAgICAgIC0+c2V0U2VjdGlvbignZ29tYWdlX2FjdGl2YXRpb24nKQogICAgICAgICAgICAtPnNldEdyb3VwcygkZ3JvdXBzKQogICAgICAgICAgICAtPnNhdmUoKTsKCiAgICAgICAgTWFnZTo6Z2V0Q29uZmlnKCktPnJlaW5pdCgpOwogICAgICAgIE1hZ2U6OmFwcCgpLT5yZWluaXRTdG9yZXMoKTsKCiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGdhKCkKICAgIHsKICAgICAgICAkYXIgPSBiYXNlNjRfZGVjb2RlKE1hZ2U6OmhlbHBlcignY29yZScpLT5kZWNyeXB0KE1hZ2U6OmdldFN0b3JlQ29uZmlnKCdnb21hZ2VfYWN0aXZhdGlvbi9kZXNpZ25lci9hcicpKSk7CiAgICAgICAgcmV0dXJuICRhciA/IFplbmRfSnNvbjo6ZGVjb2RlKCRhcikgOiBhcnJheSgpOwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBub3RpZnkoKQogICAgewogICAgICAgICRmcmVxdWVuY3kgPSBpbnR2YWwoTWFnZTo6YXBwKCktPmxvYWRDYWNoZSgnZ29tYWdlX25vdGlmaWNhdGlvbnNfZnJlcXVlbmN5JykpOwogICAgICAgIGlmICghJGZyZXF1ZW5jeSkgewogICAgICAgICAgICAkZnJlcXVlbmN5ID0gMjQ7CiAgICAgICAgfQogICAgICAgICRsYXN0X3VwZGF0ZSA9IGludHZhbChNYWdlOjphcHAoKS0+bG9hZENhY2hlKCdnb21hZ2Vfbm90aWZpY2F0aW9uc19sYXN0X3VwZGF0ZScpKTsKCiAgICAgICAgaWYgKCgkZnJlcXVlbmN5ICogNjAgKiA2MCArICRsYXN0X3VwZGF0ZSkgPiB0aW1lKCkpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgJHRpbWVzdGFtcCA9ICRsYXN0X3VwZGF0ZTsKICAgICAgICBpZiAoISR0aW1lc3RhbXApIHsKICAgICAgICAgICAgJHRpbWVzdGFtcCA9IHRpbWUoKTsKICAgICAgICB9CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgICRjaCA9IGN1cmxfaW5pdCgpOwogICAgICAgICAgICBjdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfVVJMLCBzcHJpbnRmKCdodHRwczovL3d3dy5nb21hZ2UuY29tL2luZGV4LnBocC9nb21hZ2Vfbm90aWZpY2F0aW9uL2luZGV4L2RhdGEnKSk7CiAgICAgICAgICAgIGN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9QT1NULCB0cnVlKTsKICAgICAgICAgICAgY3VybF9zZXRvcHQoJGNoLCBDVVJMT1BUX1BPU1RGSUVMRFMsICdza3U9cHJvZHVjdC1kZXNpZ25lciZ0aW1lc3RhbXA9JyAuICR0aW1lc3RhbXAgLiAnJnZlcj0nIC4gdXJsZW5jb2RlKCcyLjUuMCcpKTsKICAgICAgICAgICAgY3VybF9zZXRvcHQoJGNoLCBDVVJMT1BUX1RJTUVPVVQsIDMwKTsKICAgICAgICAgICAgY3VybF9zZXRvcHQoJGNoLCBDVVJMT1BUX1JFVFVSTlRSQU5TRkVSLCB0cnVlKTsKCiAgICAgICAgICAgIGN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9TU0xfVkVSSUZZUEVFUiwgMCk7CiAgICAgICAgICAgIGN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9TU0xfVkVSSUZZSE9TVCwgMCk7CgogICAgICAgICAgICAkY29udGVudCA9IGN1cmxfZXhlYygkY2gpOwoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICRyZXN1bHQgPSBaZW5kX0pzb246OmRlY29kZSgkY29udGVudCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKFxFeGNlcHRpb24gJGUpIHsKICAgICAgICAgICAgICAgICRyZXN1bHQgPSBhcnJheSgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoJHJlc3VsdCAmJiBpc3NldCgkcmVzdWx0WydmcmVxdWVuY3knXSkgJiYgKCRyZXN1bHRbJ2ZyZXF1ZW5jeSddICE9ICRmcmVxdWVuY3kpKSB7CiAgICAgICAgICAgICAgICBNYWdlOjphcHAoKS0+c2F2ZUNhY2hlKCRyZXN1bHRbJ2ZyZXF1ZW5jeSddLCAnZ29tYWdlX25vdGlmaWNhdGlvbnNfZnJlcXVlbmN5Jyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICgkcmVzdWx0ICYmIGlzc2V0KCRyZXN1bHRbJ2RhdGEnXSkpIHsKICAgICAgICAgICAgICAgIGlmICghZW1wdHkoJHJlc3VsdFsnZGF0YSddKSkgewogICAgICAgICAgICAgICAgICAgIE1hZ2U6OmdldE1vZGVsKCdhZG1pbm5vdGlmaWNhdGlvbi9pbmJveCcpLT5wYXJzZSgkcmVzdWx0WydkYXRhJ10pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uICRlKSB7CiAgICAgICAgfQoKICAgICAgICBNYWdlOjphcHAoKS0+c2F2ZUNhY2hlKHRpbWUoKSwgJ2dvbWFnZV9ub3RpZmljYXRpb25zX2xhc3RfdXBkYXRlJyk7CiAgICB9Cn0K"));
