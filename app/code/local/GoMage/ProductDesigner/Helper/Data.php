<?php eval(base64_decode("DQovKioNCiAqIEdvTWFnZSBQcm9kdWN0IERlc2lnbmVyIEV4dGVuc2lvbg0KICoNCiAqIEBjYXRlZ29yeSAgICAgRXh0ZW5zaW9uDQogKiBAY29weXJpZ2h0ICAgIENvcHlyaWdodCAoYykgMjAxMy0yMDE3IEdvTWFnZSAoaHR0cHM6Ly93d3cuZ29tYWdlLmNvbSkNCiAqIEBhdXRob3IgICAgICAgR29NYWdlDQogKiBAbGljZW5zZSAgICAgIGh0dHBzOi8vd3d3LmdvbWFnZS5jb20vbGljZW5zZS1hZ3JlZW1lbnQvICBTaW5nbGUgZG9tYWluIGxpY2Vuc2UNCiAqIEB0ZXJtcyBvZiB1c2UgaHR0cHM6Ly93d3cuZ29tYWdlLmNvbS90ZXJtcy1vZi11c2UvDQogKiBAdmVyc2lvbiAgICAgIFJlbGVhc2U6IDIuNS4wDQogKiBAc2luY2UgICAgICAgIEF2YWlsYWJsZSBzaW5jZSBSZWxlYXNlIDEuMC4wDQogKi8NCmNsYXNzIEdvTWFnZV9Qcm9kdWN0RGVzaWduZXJfSGVscGVyX0RhdGEgZXh0ZW5kcyBNYWdlX0NvcmVfSGVscGVyX0Fic3RyYWN0DQp7DQogICAgY29uc3QgQURWQU5DRURfTkFWSUdBVElPTl9NT0RVTEVfTkFNRSA9ICdHb01hZ2VfTmF2aWdhdGlvbic7DQoNCiAgICBwcm90ZWN0ZWQgJF9hbGxvd2VkUHJvZHVjdFR5cGVzID0gYXJyYXkoDQogICAgICAgIE1hZ2VfQ2F0YWxvZ19Nb2RlbF9Qcm9kdWN0X1R5cGU6OlRZUEVfU0lNUExFLA0KICAgICAgICBNYWdlX0NhdGFsb2dfTW9kZWxfUHJvZHVjdF9UeXBlOjpUWVBFX0NPTkZJR1VSQUJMRQ0KICAgICk7DQoNCiAgICBwcm90ZWN0ZWQgJF9wcm9kdWN0U2V0dGluZ3M7DQoNCiAgICBwcm90ZWN0ZWQgJF9wcm9kdWN0RGVzaWduID0gbnVsbDsNCg0KICAgIHByb3RlY3RlZCAkX2VkaXRvckNvbmZpZyA9IG51bGw7DQoNCiAgICBwdWJsaWMgZnVuY3Rpb24gaXNFbmFibGVkKCkNCiAgICB7DQogICAgICAgIHJldHVybiBNYWdlOjpnZXRTdG9yZUNvbmZpZygnZ29tYWdlX2Rlc2lnbmVyL2dlbmVyYWwvZW5hYmxlZCcsIE1hZ2U6OmFwcCgpLT5nZXRTdG9yZSgpKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgZnVuY3Rpb24gaXNOYXZpZ2F0aW9uRW5hYmxlZCgpDQogICAgew0KICAgICAgICByZXR1cm4gTWFnZTo6Z2V0U3RvcmVDb25maWcoJ2dvbWFnZV9kZXNpZ25lci9uYXZpZ2F0aW9uL2VuYWJsZWQnLCBNYWdlOjphcHAoKS0+Z2V0U3RvcmUoKSk7DQogICAgfQ0KDQogICAgcHVibGljIGZ1bmN0aW9uIGFkdmFuY2VkTmF2aWdhdGlvbkVuYWJsZWQoKQ0KICAgIHsNCiAgICAgICAgJG1vZHVsZXMgPSAoYXJyYXkpTWFnZTo6Z2V0Q29uZmlnKCktPmdldE5vZGUoJ21vZHVsZXMnKS0+Y2hpbGRyZW4oKTsNCiAgICAgICAgaWYgKGlzc2V0KCRtb2R1bGVzW3NlbGY6OkFEVkFOQ0VEX05BVklHQVRJT05fTU9EVUxFX05BTUVdKSkgew0KICAgICAgICAgICAgJG1vZHVsZSA9ICRtb2R1bGVzW3NlbGY6OkFEVkFOQ0VEX05BVklHQVRJT05fTU9EVUxFX05BTUVdOw0KICAgICAgICAgICAgcmV0dXJuICRtb2R1bGUtPmlzKCdhY3RpdmUnKSAmJiBNYWdlOjpnZXRTdG9yZUNvbmZpZygnZ29tYWdlX25hdmlnYXRpb24vZ2VuZXJhbC9tb2RlJyk7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KDQogICAgcHVibGljIGZ1bmN0aW9uIGlzRW50ZXJwcmlzZUVkaXRpb24oKQ0KICAgIHsNCiAgICAgICAgJG1vZHVsZXMgPSAoYXJyYXkpTWFnZTo6Z2V0Q29uZmlnKCktPmdldE5vZGUoJ21vZHVsZXMnKS0+Y2hpbGRyZW4oKTsNCiAgICAgICAgcmV0dXJuIGlzc2V0KCRtb2R1bGVzWydFbnRlcnByaXNlX1RhcmdldFJ1bGUnXSk7DQogICAgfQ0KDQogICAgcHVibGljIGZ1bmN0aW9uIGlzTW9kdWxlRXhpc3RzKCRtb2R1bGVOYW1lKQ0KICAgIHsNCiAgICAgICAgJG1vZHVsZXMgPSAoYXJyYXkpTWFnZTo6Z2V0Q29uZmlnKCktPmdldE5vZGUoJ21vZHVsZXMnKS0+Y2hpbGRyZW4oKTsNCiAgICAgICAgcmV0dXJuIGlzc2V0KCRtb2R1bGVzWyRtb2R1bGVOYW1lXSk7DQogICAgfQ0KDQogICAgcHVibGljIGZ1bmN0aW9uIGdldElzQW55bW9yZVZlcnNpb24oJG1ham9yLCAkbWlub3IsICRyZXZpc2lvbiA9IDApDQogICAgew0KICAgICAgICAkdmVyc2lvbl9pbmZvID0gTWFnZTo6Z2V0VmVyc2lvbkluZm8oKTsNCg0KICAgICAgICBpZiAoJHZlcnNpb25faW5mb1snbWFqb3InXSA+ICRtYWpvcikgew0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0gZWxzZWlmICgkdmVyc2lvbl9pbmZvWydtYWpvciddID09ICRtYWpvcikgew0KICAgICAgICAgICAgaWYgKCR2ZXJzaW9uX2luZm9bJ21pbm9yJ10gPiAkbWlub3IpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgIH0gZWxzZWlmICgkdmVyc2lvbl9pbmZvWydtaW5vciddID09ICRtaW5vcikgew0KICAgICAgICAgICAgICAgIGlmICgkdmVyc2lvbl9pbmZvWydyZXZpc2lvbiddID49ICRyZXZpc2lvbikgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogUmV0dXJuIGFsbG93ZWQgcHJvZHVjdCB0eXBlcw0KICAgICAqDQogICAgICogQHJldHVybiBhcnJheQ0KICAgICAqLw0KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRBbGxvd2VkUHJvZHVjdFR5cGVzKCkNCiAgICB7DQogICAgICAgIHJldHVybiAkdGhpcy0+X2FsbG93ZWRQcm9kdWN0VHlwZXM7DQogICAgfQ0KDQogICAgcHVibGljIGZ1bmN0aW9uIGhhc0NvbG9yQXR0cmlidXRlKCkNCiAgICB7DQogICAgICAgICRhdHRyaWJ1dGVDb2RlID0gTWFnZTo6Z2V0U3RvcmVDb25maWcoJ2dvbWFnZV9kZXNpZ25lci9uYXZpZ2F0aW9uL2NvbG9yX2F0dHJpYnV0ZScpOw0KICAgICAgICAkYXR0cmlidXRlICAgICA9IE1hZ2U6OmdldFNpbmdsZXRvbignZWF2L2NvbmZpZycpDQogICAgICAgICAgICAtPmdldEF0dHJpYnV0ZShNYWdlX0NhdGFsb2dfTW9kZWxfUHJvZHVjdDo6RU5USVRZLCAkYXR0cmlidXRlQ29kZSk7DQogICAgICAgIHJldHVybiAkYXR0cmlidXRlLT5nZXRJZCgpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFJldHVybiBJbWFnZSBTZXR0aW5ncw0KICAgICAqDQogICAgICogQHBhcmFtIE1hZ2VfQ2F0YWxvZ19Nb2RlbF9Qcm9kdWN0ICRwcm9kdWN0IFByb2R1Y3QNCiAgICAgKiBAcGFyYW0gaW50ICRpbWFnZUlkIEltYWdlIElkDQogICAgICogQHJldHVybiBib29sZWFufGFycmF5DQogICAgICovDQogICAgcHVibGljIGZ1bmN0aW9uIGdldEltYWdlU2V0dGluZ3MoTWFnZV9DYXRhbG9nX01vZGVsX1Byb2R1Y3QgJHByb2R1Y3QsICRpbWFnZUlkKQ0KICAgIHsNCiAgICAgICAgJHNldHRpbmdzID0gJHRoaXMtPmdldFNldHRpbmdzKCRwcm9kdWN0KTsNCiAgICAgICAgaWYgKGlzc2V0KCRzZXR0aW5nc1skaW1hZ2VJZF0pKSB7DQogICAgICAgICAgICByZXR1cm4gJHNldHRpbmdzWyRpbWFnZUlkXTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogUmV0dXJuIFByb2R1Y3QgaW1hZ2VzIHNldHRpbmdzDQogICAgICoNCiAgICAgKiBAcGFyYW0gTWFnZV9DYXRhbG9nX01vZGVsX1Byb2R1Y3QgJHByb2R1Y3QgUHJvZHVjdA0KICAgICAqIEByZXR1cm4gYXJyYXkNCiAgICAgKi8NCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0U2V0dGluZ3MoTWFnZV9DYXRhbG9nX01vZGVsX1Byb2R1Y3QgJHByb2R1Y3QpDQogICAgew0KICAgICAgICBpZiAoISR0aGlzLT5fcHJvZHVjdFNldHRpbmdzKSB7DQogICAgICAgICAgICAkc2V0dGluZ3MgPSBhcnJheSgpOw0KICAgICAgICAgICAgJGltYWdlcyAgID0gJHByb2R1Y3QtPmdldE1lZGlhR2FsbGVyeUltYWdlcygpOw0KICAgICAgICAgICAgZm9yZWFjaCAoJGltYWdlcyBhcyAkaW1hZ2UpIHsNCiAgICAgICAgICAgICAgICBpZiAoJGltYWdlWydkZXNpZ25fYXJlYSddKSB7DQogICAgICAgICAgICAgICAgICAgICRkZXNpZ25BcmVhID0gTWFnZTo6aGVscGVyKCdjb3JlJyktPmpzb25EZWNvZGUoJGltYWdlWydkZXNpZ25fYXJlYSddKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgJGltYWdlSWQgICAgPSAkaW1hZ2VbJ3ZhbHVlX2lkJ107DQogICAgICAgICAgICAgICAgaWYgKGlzc2V0KCRkZXNpZ25BcmVhKSAmJiAkZGVzaWduQXJlYSAmJiAhZW1wdHkoJGRlc2lnbkFyZWEpKSB7DQogICAgICAgICAgICAgICAgICAgICRpbWFnZVVybCAgID0gJHRoaXMtPmdldERlc2lnbkltYWdlVXJsKCRwcm9kdWN0LCAkaW1hZ2UpOw0KICAgICAgICAgICAgICAgICAgICAkZGltZW5zaW9ucyA9ICR0aGlzLT5nZXRJbWFnZURpbWVuc2lvbnMoJGltYWdlVXJsKTsNCg0KICAgICAgICAgICAgICAgICAgICAkYmFzZVVybCA9IE1hZ2U6OmdldEJhc2VVcmwoJ21lZGlhJyk7DQogICAgICAgICAgICAgICAgICAgICRiYXNlRGlyID0gTWFnZTo6Z2V0QmFzZURpcignbWVkaWEnKSAuIERTOw0KDQogICAgICAgICAgICAgICAgICAgICRkZXNpZ25BcmVhWydwYXRoJ10gICAgICAgICAgID0gc3RyX3JlcGxhY2UoJGJhc2VVcmwsICRiYXNlRGlyLCAkaW1hZ2VVcmwpOw0KICAgICAgICAgICAgICAgICAgICAkZGVzaWduQXJlYVsnZGltZW5zaW9ucyddICAgICA9IGFycmF5KA0KICAgICAgICAgICAgICAgICAgICAgICAgJ3dpZHRoJyAgPT4gJGRpbWVuc2lvbnNbMF0sDQogICAgICAgICAgICAgICAgICAgICAgICAnaGVpZ2h0JyA9PiAkZGltZW5zaW9uc1sxXQ0KICAgICAgICAgICAgICAgICAgICApOw0KICAgICAgICAgICAgICAgICAgICAkZGVzaWduQXJlYVsnb3JpZ2luYWxfaW1hZ2UnXSA9ICR0aGlzLT5nZXRPcmlnaW5hbEltYWdlKCRwcm9kdWN0LCAkaW1hZ2UpOw0KICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJGRlc2lnbkFyZWFbJ29yaWdpbmFsX2ltYWdlJ11bJ3VybCddKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgJGRlc2lnbkFyZWFbJ29yaWdpbmFsX2ltYWdlJ11bJ3BhdGgnXSA9IHN0cl9yZXBsYWNlKA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRiYXNlVXJsLCAkYmFzZURpciwgJGRlc2lnbkFyZWFbJ29yaWdpbmFsX2ltYWdlJ11bJ3VybCddDQogICAgICAgICAgICAgICAgICAgICAgICApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICRzZXR0aW5nc1skaW1hZ2VJZF0gPSAkZGVzaWduQXJlYTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICAkdGhpcy0+X3Byb2R1Y3RTZXR0aW5ncyA9ICRzZXR0aW5nczsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gJHRoaXMtPl9wcm9kdWN0U2V0dGluZ3M7DQogICAgfQ0KDQogICAgcHVibGljIGZ1bmN0aW9uIGpzb25EZWNvZGUoJHN0cmluZykNCiAgICB7DQogICAgICAgICRyZXN1bHQgPSBhcnJheSgpOw0KICAgICAgICBpZiAoJHN0cmluZykgew0KICAgICAgICAgICAgJHNldHRpbmdzID0gTWFnZTo6aGVscGVyKCdjb3JlJyktPmpzb25EZWNvZGUoJHN0cmluZyk7DQogICAgICAgICAgICBmb3JlYWNoICgkc2V0dGluZ3MgYXMgJGkgPT4gJHYpIHsNCiAgICAgICAgICAgICAgICAkcmVzdWx0WyRpXSA9IChhcnJheSkkdjsNCiAgICAgICAgICAgICAgICBpZiAoIWlzc2V0KCRyZXN1bHRbJGldWydzJ10pKSB7DQogICAgICAgICAgICAgICAgICAgICRyZXN1bHRbJGldWydzJ10gPSAxOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiAkcmVzdWx0Ow0KICAgIH0NCg0KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRJbWFnZURpbWVuc2lvbnMoJGltYWdlUGF0aCkNCiAgICB7DQogICAgICAgICRkaXJJbWcgPSBNYWdlOjpnZXRCYXNlRGlyKCkgLiBzdHJfcmVwbGFjZSgiLyIsIERTLCBzdHJzdHIoJGltYWdlUGF0aCwgJy9tZWRpYScpKTsNCg0KICAgICAgICBpZiAoZmlsZV9leGlzdHMoJGRpckltZykpIHsNCiAgICAgICAgICAgICRpbWFnZU9iaiA9IG5ldyBWYXJpZW5fSW1hZ2UoJGRpckltZyk7DQogICAgICAgICAgICAkd2lkdGggICAgPSAkaW1hZ2VPYmotPmdldE9yaWdpbmFsV2lkdGgoKTsNCiAgICAgICAgICAgICRoZWlnaHQgICA9ICRpbWFnZU9iai0+Z2V0T3JpZ2luYWxIZWlnaHQoKTsNCiAgICAgICAgICAgIHJldHVybiBhcnJheSgkd2lkdGgsICRoZWlnaHQpOw0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIGFycmF5KDAsIDApOw0KICAgIH0NCg0KICAgIHB1YmxpYyBmdW5jdGlvbiBwcmVwYXJlRGVzaWduZXJTZXNzaW9uSWQoKQ0KICAgIHsNCiAgICAgICAgJGN1c3RvbWVyU2Vzc2lvbiA9ICR0aGlzLT5fZ2V0Q3VzdG9tZXJTZXNzaW9uKCk7DQogICAgICAgIGlmICghJGN1c3RvbWVyU2Vzc2lvbi0+Z2V0RGVzaWduZXJTZXNzaW9uSWQoKSkgew0KICAgICAgICAgICAgJGN1c3RvbWVyU2Vzc2lvbi0+c2V0RGVzaWduZXJTZXNzaW9uSWQoc2hhMShyYW5kKDAsIDEwMDApIC4gbWljcm90aW1lKHRydWUpKSk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0RGVzaWduZXJTZXNzaW9uSWQoKQ0KICAgIHsNCiAgICAgICAgJHNlc3Npb25JZCA9ICR0aGlzLT5fZ2V0Q3VzdG9tZXJTZXNzaW9uKCktPmdldEVuY3J5cHRlZFNlc3Npb25JZCgpOw0KICAgICAgICByZXR1cm4gJHNlc3Npb25JZDsNCiAgICB9DQoNCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gX2dldEN1c3RvbWVyU2Vzc2lvbigpDQogICAgew0KICAgICAgICByZXR1cm4gTWFnZTo6Z2V0U2luZ2xldG9uKCdjdXN0b21lci9zZXNzaW9uJyk7DQogICAgfQ0KDQogICAgcHVibGljIGZ1bmN0aW9uIGdldERlc2lnbldpZHRoKCkNCiAgICB7DQogICAgICAgIHJldHVybiBHb01hZ2VfUHJvZHVjdERlc2lnbmVyX01vZGVsX0Rlc2lnbjo6REVTSUdOX1NJWkVfV0lEVEg7DQogICAgfQ0KDQogICAgcHVibGljIGZ1bmN0aW9uIGdldERlc2lnbkhlaWdodCgpDQogICAgew0KICAgICAgICByZXR1cm4gR29NYWdlX1Byb2R1Y3REZXNpZ25lcl9Nb2RlbF9EZXNpZ246OkRFU0lHTl9TSVpFX0hFSUdIVDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBSZXR1cm4gSW1hZ2UgVXJsDQogICAgICoNCiAgICAgKiBAcGFyYW0gTWFnZV9DYXRhbG9nX01vZGVsX1Byb2R1Y3QgJHByb2R1Y3QgUHJvZHVjdA0KICAgICAqIEBwYXJhbSBWYXJpZW5fT2JqZWN0ICRpbWFnZSBJbWFnZQ0KICAgICAqIEBwYXJhbSBhcnJheSAkc2l6ZSBTaXplDQogICAgICogQHJldHVybiBzdHJpbmcNCiAgICAgKi8NCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0RGVzaWduSW1hZ2VVcmwoTWFnZV9DYXRhbG9nX01vZGVsX1Byb2R1Y3QgJHByb2R1Y3QsICRpbWFnZSwgJHNpemUgPSBhcnJheSgpKQ0KICAgIHsNCiAgICAgICAgaWYgKGVtcHR5KCRzaXplKSkgew0KICAgICAgICAgICAgJGltYWdlV2lkdGggID0gJHRoaXMtPmdldERlc2lnbldpZHRoKCk7DQogICAgICAgICAgICAkaW1hZ2VIZWlnaHQgPSAkdGhpcy0+Z2V0RGVzaWduSGVpZ2h0KCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBsaXN0KCRpbWFnZVdpZHRoLCAkaW1hZ2VIZWlnaHQpID0gJHNpemU7DQogICAgICAgIH0NCg0KICAgICAgICAkaW1hZ2VGaWxlID0gaXNfb2JqZWN0KCRpbWFnZSkgPyAkaW1hZ2UtPmdldEZpbGUoKSA6ICRpbWFnZVsnZmlsZSddOw0KICAgICAgICByZXR1cm4gTWFnZTo6aGVscGVyKCdjYXRhbG9nL2ltYWdlJykNCiAgICAgICAgICAgIC0+aW5pdCgkcHJvZHVjdCwgJ2Jhc2VfaW1hZ2UnLCAkaW1hZ2VGaWxlKQ0KICAgICAgICAgICAgLT5rZWVwRnJhbWUoZmFsc2UpDQogICAgICAgICAgICAtPnJlc2l6ZSgkaW1hZ2VXaWR0aCwgJGltYWdlSGVpZ2h0KQ0KICAgICAgICAgICAgLT5fX3RvU3RyaW5nKCk7DQogICAgfQ0KDQogICAgcHVibGljIGZ1bmN0aW9uIGdldE9yaWdpbmFsSW1hZ2UoTWFnZV9DYXRhbG9nX01vZGVsX1Byb2R1Y3QgJHByb2R1Y3QsICRpbWFnZSkNCiAgICB7DQogICAgICAgICRpbWFnZUZpbGUgPSBpc19vYmplY3QoJGltYWdlKSA/ICRpbWFnZS0+Z2V0RmlsZSgpIDogJGltYWdlWydmaWxlJ107DQogICAgICAgICRpbWFnZVBhdGggPSAkcHJvZHVjdC0+Z2V0TWVkaWFDb25maWcoKS0+Z2V0TWVkaWFQYXRoKCRpbWFnZUZpbGUpOw0KICAgICAgICAkbWluV2lkdGggID0gTWFnZTo6Z2V0U3RvcmVDb25maWcoJ2dvbWFnZV9kZXNpZ25lci9nZW5lcmFsL3pvb21fc2l6ZV93aWR0aCcpOw0KICAgICAgICAkbWluSGVpZ2h0ID0gTWFnZTo6Z2V0U3RvcmVDb25maWcoJ2dvbWFnZV9kZXNpZ25lci9nZW5lcmFsL3pvb21fc2l6ZV9oZWlnaHQnKTsNCiAgICAgICAgaWYgKGZpbGVfZXhpc3RzKCRpbWFnZVBhdGgpKSB7DQogICAgICAgICAgICAkaW1hZ2VPYmogICA9IG5ldyBWYXJpZW5fSW1hZ2UoJGltYWdlUGF0aCk7DQogICAgICAgICAgICAkd2lkdGggICAgICA9ICRpbWFnZU9iai0+Z2V0T3JpZ2luYWxXaWR0aCgpOw0KICAgICAgICAgICAgJGhlaWdodCAgICAgPSAkaW1hZ2VPYmotPmdldE9yaWdpbmFsSGVpZ2h0KCk7DQogICAgICAgICAgICAkZGltZW5zaW9ucyA9IGFycmF5KCk7DQogICAgICAgICAgICBpZiAoJHdpZHRoIDwgJG1pbldpZHRoICYmICRoZWlnaHQgPCAkbWluSGVpZ2h0KSB7DQogICAgICAgICAgICAgICAgJGRpbWVuc2lvbnNbMF0gPSAkbWluV2lkdGg7DQogICAgICAgICAgICAgICAgJGRpbWVuc2lvbnNbMV0gPSAkbWluSGVpZ2h0Ow0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAkZGltZW5zaW9uc1swXSA9ICR3aWR0aDsNCiAgICAgICAgICAgICAgICAkZGltZW5zaW9uc1sxXSA9ICRoZWlnaHQ7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gYXJyYXkoDQogICAgICAgICAgICAgICAgJ3VybCcgICAgICAgID0+ICR0aGlzLT5nZXREZXNpZ25JbWFnZVVybCgkcHJvZHVjdCwgJGltYWdlLCAkZGltZW5zaW9ucyksDQogICAgICAgICAgICAgICAgJ2RpbWVuc2lvbnMnID0+ICRkaW1lbnNpb25zDQogICAgICAgICAgICApOw0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIGFycmF5KCk7DQogICAgfQ0KDQogICAgcHVibGljIGZ1bmN0aW9uIGdldFByb2R1Y3RTZXR0aW5nRm9yRWRpdG9yKE1hZ2VfQ2F0YWxvZ19Nb2RlbF9Qcm9kdWN0ICRwcm9kdWN0ID0gbnVsbCkNCiAgICB7DQogICAgICAgIGlmICghJHRoaXMtPl9lZGl0b3JDb25maWcpIHsNCiAgICAgICAgICAgIGlmIChpc19udWxsKCRwcm9kdWN0KSkgew0KICAgICAgICAgICAgICAgICRwcm9kdWN0ID0gTWFnZTo6cmVnaXN0cnkoJ3Byb2R1Y3QnKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgJGVkaXRvckNvbmZpZyA9IGFycmF5KA0KICAgICAgICAgICAgICAgICdpbWFnZXMnID0+IGFycmF5KCkNCiAgICAgICAgICAgICk7DQoNCiAgICAgICAgICAgIGlmICghJHByb2R1Y3QtPmdldElkKCkpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gJGVkaXRvckNvbmZpZzsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgJGltYWdlcyA9ICRwcm9kdWN0LT5nZXRNZWRpYUdhbGxlcnlJbWFnZXMoKTsNCg0KICAgICAgICAgICAgJGNvbG9yQXR0cmlidXRlQ29kZSA9IE1hZ2U6OmdldFN0b3JlQ29uZmlnKCdnb21hZ2VfZGVzaWduZXIvbmF2aWdhdGlvbi9jb2xvcl9hdHRyaWJ1dGUnKTsNCiAgICAgICAgICAgICRkZWZhdWx0Q29sb3IgICAgICAgPSBudWxsOw0KICAgICAgICAgICAgZm9yZWFjaCAoJGltYWdlcyBhcyAkaW1hZ2UpIHsNCiAgICAgICAgICAgICAgICAkaWQgICAgICAgPSAkaW1hZ2VbJ3ZhbHVlX2lkJ107DQogICAgICAgICAgICAgICAgaWYgKCRpbWFnZVsnZGVzaWduX2FyZWEnXSkgew0KICAgICAgICAgICAgICAgICAgICAkc2V0dGluZ3MgPSBNYWdlOjpoZWxwZXIoJ2NvcmUnKS0+anNvbkRlY29kZSgkaW1hZ2VbJ2Rlc2lnbl9hcmVhJ10pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoIWlzc2V0KCRzZXR0aW5ncykgfHwgISRzZXR0aW5ncyB8fCBlbXB0eSgkc2V0dGluZ3MpKSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAkaW1hZ2VVcmwgICAgICAgICAgID0gJHRoaXMtPmdldERlc2lnbkltYWdlVXJsKCRwcm9kdWN0LCAkaW1hZ2UpOw0KICAgICAgICAgICAgICAgICRjb25mICAgICAgICAgICAgICAgPSAkc2V0dGluZ3M7DQogICAgICAgICAgICAgICAgJGNvbmZbJ2lkJ10gICAgICAgICA9ICRpZDsNCiAgICAgICAgICAgICAgICAkY29uZlsndSddICAgICAgICAgID0gJGltYWdlVXJsOw0KICAgICAgICAgICAgICAgICRjb25mWydkJ10gICAgICAgICAgPSAkdGhpcy0+Z2V0SW1hZ2VEaW1lbnNpb25zKCRpbWFnZVVybCk7DQogICAgICAgICAgICAgICAgJGNvbmZbJ29yaWdfaW1hZ2UnXSA9ICR0aGlzLT5nZXRPcmlnaW5hbEltYWdlKCRwcm9kdWN0LCAkaW1hZ2UpOw0KICAgICAgICAgICAgICAgICRjb25mWydpY28nXSAgICAgICAgPSAkdGhpcy0+Z2V0RGVzaWduSW1hZ2VVcmwoJHByb2R1Y3QsICRpbWFnZSwgYXJyYXkoNjAsIDYwKSk7DQoNCiAgICAgICAgICAgICAgICBpZiAoJHByb2R1Y3QtPmdldFR5cGVJZCgpID09IE1hZ2VfQ2F0YWxvZ19Nb2RlbF9Qcm9kdWN0X1R5cGU6OlRZUEVfQ09ORklHVVJBQkxFKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICgkaW1hZ2VbJ2NvbG9yJ10pIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc19udWxsKCRkZWZhdWx0Q29sb3IpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRlZmF1bHRDb2xvciA9ICRpbWFnZVsnY29sb3InXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaXNzZXQoJGVkaXRvckNvbmZpZ1snaW1hZ2VzJ11bJGltYWdlWydjb2xvciddXSkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZWRpdG9yQ29uZmlnWydpbWFnZXMnXVskaW1hZ2VbJ2NvbG9yJ11dID0gYXJyYXkoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICRlZGl0b3JDb25maWdbJ2ltYWdlcyddWyRpbWFnZVsnY29sb3InXV1bJGlkXSA9ICRjb25mOw0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgJGRlZmF1bHRDb2xvciAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA9ICRwcm9kdWN0LT5nZXREYXRhKCRjb2xvckF0dHJpYnV0ZUNvZGUpID86ICdub25lX2NvbG9yJzsNCiAgICAgICAgICAgICAgICAgICAgICAgICRlZGl0b3JDb25maWdbJ2ltYWdlcyddWyRkZWZhdWx0Q29sb3JdWyRpZF0gPSAkY29uZjsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICRkZWZhdWx0Q29sb3IgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPSAnbm9uZV9jb2xvcic7DQogICAgICAgICAgICAgICAgICAgICRlZGl0b3JDb25maWdbJ2ltYWdlcyddWyRkZWZhdWx0Q29sb3JdWyRpZF0gPSAkY29uZjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgJGVkaXRvckNvbmZpZ1snZGVmYXVsdF9jb2xvciddID0gJGRlZmF1bHRDb2xvcjsNCiAgICAgICAgICAgICAgICAkZWRpdG9yQ29uZmlnWyd1cmwnXSAgICAgICAgICAgPSAkcHJvZHVjdC0+Z2V0UHJvZHVjdFVybCgpOw0KICAgICAgICAgICAgICAgICRlZGl0b3JDb25maWdbJ25hbWUnXSAgICAgICAgICA9ICRwcm9kdWN0LT5nZXROYW1lKCk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICR0aGlzLT5fZWRpdG9yQ29uZmlnID0gJGVkaXRvckNvbmZpZzsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiAkdGhpcy0+X2VkaXRvckNvbmZpZzsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBTYXZlIHByb2R1Y3QgZGVzaWduIGltYWdlcw0KICAgICAqDQogICAgICogQHJldHVybiBHb01hZ2VfUHJvZHVjdERlc2lnbmVyX01vZGVsX0Rlc2lnbg0KICAgICAqIEB0aHJvd3MgRXhjZXB0aW9uDQogICAgICovDQogICAgcHVibGljIGZ1bmN0aW9uIHNhdmVQcm9kdWN0RGVzaWduZWRJbWFnZXMoKQ0KICAgIHsNCiAgICAgICAgJHByb2R1Y3QgPSAkdGhpcy0+aW5pdGlhbGl6ZVByb2R1Y3QoKTsNCiAgICAgICAgJGltYWdlcyAgPSBNYWdlOjphcHAoKS0+Z2V0UmVxdWVzdCgpLT5nZXRQYXJhbSgnaW1hZ2VzJyk7DQogICAgICAgIGlmICgkcHJvZHVjdC0+Z2V0SWQoKSAmJiAkaW1hZ2VzICYmICFlbXB0eSgkaW1hZ2VzKSkgew0KICAgICAgICAgICAgJGRlc2lnbiA9IE1hZ2U6OmdldE1vZGVsKCdnb21hZ2VfZGVzaWduZXIvZGVzaWduJyktPnNhdmVEZXNpZ24oJHByb2R1Y3QsICR0aGlzLT5fZ2V0UmVxdWVzdCgpLT5nZXRQYXJhbXMoKSk7DQogICAgICAgICAgICByZXR1cm4gJGRlc2lnbjsNCiAgICAgICAgfSBlbHNlaWYgKCEkcHJvZHVjdC0+Z2V0SWQoKSkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbihNYWdlOjpoZWxwZXIoJ2dvbWFnZV9kZXNpZ25lcicpLT5fXygnUHJvZHVjdCBpcyBub3QgZGVmaW5lZCcpKTsNCiAgICAgICAgfSBlbHNlaWYgKCEkaW1hZ2VzIHx8IGVtcHR5KCRpbWFnZXMpKSB7DQogICAgICAgICAgICB0aHJvdyBuZXcgRXhjZXB0aW9uKE1hZ2U6OmhlbHBlcignZ29tYWdlX2Rlc2lnbmVyJyktPl9fKCdEZXNpZ25lZCBpbWFnZXMgYXJlIGVtcHR5JykpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgLyoqDQogICAgICogSW5pdGlhbGl6ZSBjdXJyZW50IHByb2R1Y3QgZnJvbSByZXF1ZXN0DQogICAgICoNCiAgICAgKiBAcmV0dXJuIE1hZ2VfQ2F0YWxvZ19Nb2RlbF9Qcm9kdWN0DQogICAgICovDQogICAgcHVibGljIGZ1bmN0aW9uIGluaXRpYWxpemVQcm9kdWN0KCkNCiAgICB7DQogICAgICAgICRwcm9kdWN0ID0gTWFnZTo6cmVnaXN0cnkoJ3Byb2R1Y3QnKTsNCiAgICAgICAgaWYgKCRwcm9kdWN0KSB7DQogICAgICAgICAgICByZXR1cm4gJHByb2R1Y3Q7DQogICAgICAgIH0NCiAgICAgICAgJHJlcXVlc3QgICA9IE1hZ2U6OmFwcCgpLT5nZXRSZXF1ZXN0KCk7DQogICAgICAgICRwcm9kdWN0SWQgPSAkcmVxdWVzdC0+Z2V0UGFyYW0oImlkIiwgZmFsc2UpOw0KDQogICAgICAgICRwcm9kdWN0ID0gTWFnZTo6Z2V0TW9kZWwoJ2NhdGFsb2cvcHJvZHVjdCcpOw0KICAgICAgICBpZiAoJHByb2R1Y3RJZCkgew0KICAgICAgICAgICAgJHByb2R1Y3QtPmxvYWQoJHByb2R1Y3RJZCk7DQogICAgICAgIH0NCiAgICAgICAgTWFnZTo6cmVnaXN0ZXIoJ3Byb2R1Y3QnLCAkcHJvZHVjdCk7DQoNCiAgICAgICAgcmV0dXJuICRwcm9kdWN0Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFByaWNlIGNhbGN1bGF0aW9uIGRlcGVuZGluZyBvbiBwcm9kdWN0IG9wdGlvbnMNCiAgICAgKg0KICAgICAqIEByZXR1cm4gYXJyYXkNCiAgICAgKi8NCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0UHJvZHVjdFByaWNlQ29uZmlnKCkNCiAgICB7DQogICAgICAgICRjb25maWcgICA9IGFycmF5KCk7DQogICAgICAgICRfcmVxdWVzdCA9IE1hZ2U6OmdldFNpbmdsZXRvbigndGF4L2NhbGN1bGF0aW9uJyktPmdldFJhdGVSZXF1ZXN0KGZhbHNlLCBmYWxzZSwgZmFsc2UpOw0KICAgICAgICAvKiBAdmFyICRwcm9kdWN0IE1hZ2VfQ2F0YWxvZ19Nb2RlbF9Qcm9kdWN0ICovDQogICAgICAgICRwcm9kdWN0ID0gJHRoaXMtPmluaXRpYWxpemVQcm9kdWN0KCk7DQogICAgICAgICRfcmVxdWVzdC0+c2V0UHJvZHVjdENsYXNzSWQoJHByb2R1Y3QtPmdldFRheENsYXNzSWQoKSk7DQogICAgICAgICRkZWZhdWx0VGF4ID0gTWFnZTo6Z2V0U2luZ2xldG9uKCd0YXgvY2FsY3VsYXRpb24nKS0+Z2V0UmF0ZSgkX3JlcXVlc3QpOw0KDQogICAgICAgICRfcmVxdWVzdCA9IE1hZ2U6OmdldFNpbmdsZXRvbigndGF4L2NhbGN1bGF0aW9uJyktPmdldFJhdGVSZXF1ZXN0KCk7DQogICAgICAgICRfcmVxdWVzdC0+c2V0UHJvZHVjdENsYXNzSWQoJHByb2R1Y3QtPmdldFRheENsYXNzSWQoKSk7DQogICAgICAgICRjdXJyZW50VGF4ID0gTWFnZTo6Z2V0U2luZ2xldG9uKCd0YXgvY2FsY3VsYXRpb24nKS0+Z2V0UmF0ZSgkX3JlcXVlc3QpOw0KDQogICAgICAgICRfcmVndWxhclByaWNlICAgICAgPSAkcHJvZHVjdC0+Z2V0UHJpY2UoKTsNCiAgICAgICAgJF9maW5hbFByaWNlICAgICAgICA9ICRwcm9kdWN0LT5nZXRGaW5hbFByaWNlKCk7DQogICAgICAgICRfcHJpY2VJbmNsVGF4ICAgICAgPSBNYWdlOjpoZWxwZXIoJ3RheCcpLT5nZXRQcmljZSgkcHJvZHVjdCwgJF9maW5hbFByaWNlLCB0cnVlKTsNCiAgICAgICAgJF9wcmljZUV4Y2xUYXggICAgICA9IE1hZ2U6OmhlbHBlcigndGF4JyktPmdldFByaWNlKCRwcm9kdWN0LCAkX2ZpbmFsUHJpY2UpOw0KICAgICAgICAkX3RpZXJQcmljZXMgICAgICAgID0gYXJyYXkoKTsNCiAgICAgICAgJF90aWVyUHJpY2VzSW5jbFRheCA9IGFycmF5KCk7DQogICAgICAgIGZvcmVhY2ggKCRwcm9kdWN0LT5nZXRUaWVyUHJpY2UoKSBhcyAkdGllclByaWNlKSB7DQogICAgICAgICAgICAkX3RpZXJQcmljZXNbXSAgICAgICAgPSBNYWdlOjpoZWxwZXIoJ2NvcmUnKS0+Y3VycmVuY3koJHRpZXJQcmljZVsnd2Vic2l0ZV9wcmljZSddLCBmYWxzZSwgZmFsc2UpOw0KICAgICAgICAgICAgJF90aWVyUHJpY2VzSW5jbFRheFtdID0gTWFnZTo6aGVscGVyKCdjb3JlJyktPmN1cnJlbmN5KA0KICAgICAgICAgICAgICAgIE1hZ2U6OmhlbHBlcigndGF4JyktPmdldFByaWNlKCRwcm9kdWN0LCAoaW50KSR0aWVyUHJpY2VbJ3dlYnNpdGVfcHJpY2UnXSwgdHJ1ZSksDQogICAgICAgICAgICAgICAgZmFsc2UsIGZhbHNlDQogICAgICAgICAgICApOw0KICAgICAgICB9DQogICAgICAgICRjb25maWcgPSBhcnJheSgNCiAgICAgICAgICAgICdwcm9kdWN0SWQnICAgICAgICAgICA9PiAkcHJvZHVjdC0+Z2V0SWQoKSwNCiAgICAgICAgICAgICdwcmljZUZvcm1hdCcgICAgICAgICA9PiBNYWdlOjphcHAoKS0+Z2V0TG9jYWxlKCktPmdldEpzUHJpY2VGb3JtYXQoKSwNCiAgICAgICAgICAgICdpbmNsdWRlVGF4JyAgICAgICAgICA9PiBNYWdlOjpoZWxwZXIoJ3RheCcpLT5wcmljZUluY2x1ZGVzVGF4KCkgPyAndHJ1ZScgOiAnZmFsc2UnLA0KICAgICAgICAgICAgJ3Nob3dJbmNsdWRlVGF4JyAgICAgID0+IE1hZ2U6OmhlbHBlcigndGF4JyktPmRpc3BsYXlQcmljZUluY2x1ZGluZ1RheCgpLA0KICAgICAgICAgICAgJ3Nob3dCb3RoUHJpY2VzJyAgICAgID0+IE1hZ2U6OmhlbHBlcigndGF4JyktPmRpc3BsYXlCb3RoUHJpY2VzKCksDQogICAgICAgICAgICAncHJvZHVjdFByaWNlJyAgICAgICAgPT4gTWFnZTo6aGVscGVyKCdjb3JlJyktPmN1cnJlbmN5KCRfZmluYWxQcmljZSwgZmFsc2UsIGZhbHNlKSwNCiAgICAgICAgICAgICdwcm9kdWN0T2xkUHJpY2UnICAgICA9PiBNYWdlOjpoZWxwZXIoJ2NvcmUnKS0+Y3VycmVuY3koJF9yZWd1bGFyUHJpY2UsIGZhbHNlLCBmYWxzZSksDQogICAgICAgICAgICAncHJpY2VJbmNsVGF4JyAgICAgICAgPT4gTWFnZTo6aGVscGVyKCdjb3JlJyktPmN1cnJlbmN5KCRfcHJpY2VJbmNsVGF4LCBmYWxzZSwgZmFsc2UpLA0KICAgICAgICAgICAgJ3ByaWNlRXhjbFRheCcgICAgICAgID0+IE1hZ2U6OmhlbHBlcignY29yZScpLT5jdXJyZW5jeSgkX3ByaWNlRXhjbFRheCwgZmFsc2UsIGZhbHNlKSwNCiAgICAgICAgICAgIC8qKg0KICAgICAgICAgICAgICogQHZhciBza2lwQ2FsY3VsYXRlDQogICAgICAgICAgICAgKiBAZGVwcmVjYXRlZCBhZnRlciAxLjUuMS4wDQogICAgICAgICAgICAgKi8NCiAgICAgICAgICAgICdza2lwQ2FsY3VsYXRlJyAgICAgICA9PiAoJF9wcmljZUV4Y2xUYXggIT0gJF9wcmljZUluY2xUYXggPyAwIDogMSksDQogICAgICAgICAgICAnZGVmYXVsdFRheCcgICAgICAgICAgPT4gJGRlZmF1bHRUYXgsDQogICAgICAgICAgICAnY3VycmVudFRheCcgICAgICAgICAgPT4gJGN1cnJlbnRUYXgsDQogICAgICAgICAgICAnaWRTdWZmaXgnICAgICAgICAgICAgPT4gJ19jbG9uZScsDQogICAgICAgICAgICAnb2xkUGx1c0Rpc3Bvc2l0aW9uJyAgPT4gMCwNCiAgICAgICAgICAgICdwbHVzRGlzcG9zaXRpb24nICAgICA9PiAwLA0KICAgICAgICAgICAgJ3BsdXNEaXNwb3NpdGlvblRheCcgID0+IDAsDQogICAgICAgICAgICAnb2xkTWludXNEaXNwb3NpdGlvbicgPT4gMCwNCiAgICAgICAgICAgICdtaW51c0Rpc3Bvc2l0aW9uJyAgICA9PiAwLA0KICAgICAgICAgICAgJ3RpZXJQcmljZXMnICAgICAgICAgID0+ICRfdGllclByaWNlcywNCiAgICAgICAgICAgICd0aWVyUHJpY2VzSW5jbFRheCcgICA9PiAkX3RpZXJQcmljZXNJbmNsVGF4LA0KICAgICAgICApOw0KDQogICAgICAgICRyZXNwb25zZU9iamVjdCA9IG5ldyBWYXJpZW5fT2JqZWN0KCk7DQogICAgICAgIE1hZ2U6OmRpc3BhdGNoRXZlbnQoJ2NhdGFsb2dfcHJvZHVjdF92aWV3X2NvbmZpZycsIGFycmF5KCdyZXNwb25zZV9vYmplY3QnID0+ICRyZXNwb25zZU9iamVjdCkpOw0KICAgICAgICBpZiAoaXNfYXJyYXkoJHJlc3BvbnNlT2JqZWN0LT5nZXRBZGRpdGlvbmFsT3B0aW9ucygpKSkgew0KICAgICAgICAgICAgZm9yZWFjaCAoJHJlc3BvbnNlT2JqZWN0LT5nZXRBZGRpdGlvbmFsT3B0aW9ucygpIGFzICRvcHRpb24gPT4gJHZhbHVlKSB7DQogICAgICAgICAgICAgICAgJGNvbmZpZ1skb3B0aW9uXSA9ICR2YWx1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiAkY29uZmlnOw0KICAgIH0NCg0KICAgIHB1YmxpYyBmdW5jdGlvbiBmb3JtYXRGaWxlTmFtZSgkZmlsZSkNCiAgICB7DQogICAgICAgICRmb3JtYXRSZXN1bHQgPSBNYWdlOjpoZWxwZXIoJ2NhdGFsb2cvcHJvZHVjdF91cmwnKS0+Zm9ybWF0KCRmaWxlKTsNCiAgICAgICAgcmV0dXJuIHByZWdfcmVwbGFjZSgnI1tcc10rI2knLCAnLScsICRmb3JtYXRSZXN1bHQpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBmdW5jdGlvbiBjYW5BcHBseU1zcnAoJHByb2R1Y3QsICR2aXNpYmlsaXR5ID0gbnVsbCwgJGNoZWNrQXNzb2NpYXRlZEl0ZW1zID0gdHJ1ZSkNCiAgICB7DQogICAgICAgICR2ZXJzaW9uID0gTWFnZTo6Z2V0VmVyc2lvbkluZm8oKTsNCiAgICAgICAgaWYgKCgkdmVyc2lvblsnbWFqb3InXSA9PT0gJzEnKSAmJiAoKGludCkkdmVyc2lvblsnbWlub3InXSA8PSA1KSkgew0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9IGVsc2VpZiAobWV0aG9kX2V4aXN0cyhNYWdlOjpoZWxwZXIoJ2NhdGFsb2cnKSwgJ2NhbkFwcGx5TXNycCcpKSB7DQogICAgICAgICAgICByZXR1cm4gTWFnZTo6aGVscGVyKCdjYXRhbG9nJyktPmNhbkFwcGx5TXNycCgkcHJvZHVjdCwgJHZpc2liaWxpdHksICRjaGVja0Fzc29jaWF0ZWRJdGVtcyk7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogUmV0cmlldmUgdXJsIGZvciBhZGRpbmcgcHJvZHVjdCB0byB3aXNobGlzdA0KICAgICAqDQogICAgICogQHBhcmFtIGludCAkaXRlbUlkDQogICAgICoNCiAgICAgKiBAcmV0dXJuICBzdHJpbmcNCiAgICAgKi8NCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0TW92ZUZyb21DYXJ0VXJsKCRpdGVtSWQpDQogICAgew0KICAgICAgICAkdmVyc2lvbiA9IE1hZ2U6OmdldFZlcnNpb25JbmZvKCk7DQogICAgICAgIGlmICgoJHZlcnNpb25bJ21ham9yJ10gPT09ICcxJykgJiYgKChpbnQpJHZlcnNpb25bJ21pbm9yJ10gPD0gNSkpIHsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGlmIChtZXRob2RfZXhpc3RzKE1hZ2U6OmhlbHBlcignd2lzaGxpc3QnKSwgJ2dldE1vdmVGcm9tQ2FydFVybCcpKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIE1hZ2U6OmhlbHBlcignd2lzaGxpc3QnKS0+Z2V0TW92ZUZyb21DYXJ0VXJsKCRpdGVtSWQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEdldCBKU09OIGVuY29kZWQgY29uZmlndXJhdGlvbiBhcnJheSB3aGljaCBjYW4gYmUgdXNlZCBmb3IgSlMgZHluYW1pYw0KICAgICAqDQogICAgICogQHJldHVybiBzdHJpbmcNCiAgICAgKi8NCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0UHJvZHVjdFByaWNlQ29uZmlnSnNvbigpDQogICAgew0KICAgICAgICByZXR1cm4gTWFnZTo6aGVscGVyKCdjb3JlJyktPmpzb25FbmNvZGUoJHRoaXMtPmdldFByb2R1Y3RQcmljZUNvbmZpZygpKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBSZXR1cm4gcHJvZHVjdCBkZXNpZ24gZnJvbSByZXF1ZXN0DQogICAgICoNCiAgICAgKiBAcGFyYW0gTWFnZV9DYXRhbG9nX01vZGVsX1Byb2R1Y3QgJHByb2R1Y3QgUHJvZHVjdA0KICAgICAqIEByZXR1cm4gYm9vbHxNYWdlX0NvcmVfTW9kZWxfQWJzdHJhY3QNCiAgICAgKi8NCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0UHJvZHVjdERlc2lnbigkcHJvZHVjdCkNCiAgICB7DQogICAgICAgIGlmIChpc19udWxsKCR0aGlzLT5fcHJvZHVjdERlc2lnbikpIHsNCiAgICAgICAgICAgICRkZXNpZ25JZCA9IChpbnQpTWFnZTo6YXBwKCktPmdldFJlcXVlc3QoKS0+Z2V0UGFyYW0oJ2Rlc2lnbl9pZCcsIGZhbHNlKTsNCiAgICAgICAgICAgIGlmICgkZGVzaWduSWQpIHsNCiAgICAgICAgICAgICAgICAkZGVzaWduID0gTWFnZTo6Z2V0TW9kZWwoJ2dvbWFnZV9kZXNpZ25lci9kZXNpZ24nKS0+bG9hZCgkZGVzaWduSWQpOw0KICAgICAgICAgICAgICAgIGlmICgkZGVzaWduLT5nZXRJZCgpICYmICRkZXNpZ24tPmdldFByb2R1Y3RJZCgpID09ICRwcm9kdWN0LT5nZXRJZCgpKSB7DQogICAgICAgICAgICAgICAgICAgICR0aGlzLT5fcHJvZHVjdERlc2lnbiA9ICRkZXNpZ247DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPl9wcm9kdWN0RGVzaWduID0gZmFsc2U7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuICR0aGlzLT5fcHJvZHVjdERlc2lnbjsNCiAgICB9DQoNCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0QWxsU3RvcmVEb21haW5zKCkNCiAgICB7DQogICAgICAgICRkb21haW5zID0gYXJyYXkoKTsNCiAgICAgICAgZm9yZWFjaCAoTWFnZTo6YXBwKCktPmdldFdlYnNpdGVzKCkgYXMgJHdlYnNpdGUpIHsNCiAgICAgICAgICAgICR1cmwgPSAkd2Vic2l0ZS0+Z2V0Q29uZmlnKCd3ZWIvdW5zZWN1cmUvYmFzZV91cmwnKTsNCiAgICAgICAgICAgIGlmICgkZG9tYWluID0gdHJpbShwcmVnX3JlcGxhY2UoJy9eLio/XFwvXFwvKC4qKT9cXC8vJywgJyQxJywgJHVybCkpKSB7DQogICAgICAgICAgICAgICAgJGRvbWFpbnNbXSA9ICRkb21haW47DQogICAgICAgICAgICB9DQogICAgICAgICAgICAkdXJsID0gJHdlYnNpdGUtPmdldENvbmZpZygnd2ViL3NlY3VyZS9iYXNlX3VybCcpOw0KDQogICAgICAgICAgICBpZiAoJGRvbWFpbiA9IHRyaW0ocHJlZ19yZXBsYWNlKCcvXi4qP1xcL1xcLyguKik/XFwvLycsICckMScsICR1cmwpKSkgew0KICAgICAgICAgICAgICAgICRkb21haW5zW10gPSAkZG9tYWluOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIGFycmF5X3VuaXF1ZSgkZG9tYWlucyk7DQogICAgfQ0KDQogICAgcHVibGljIGZ1bmN0aW9uIGdldFdpbmRvd0Nzc1BhdGgoKQ0KICAgIHsNCiAgICAgICAgaWYgKCEkdGhpcy0+Z2V0SXNBbnltb3JlVmVyc2lvbigxLCA3KSkgew0KICAgICAgICAgICAgcmV0dXJuICdwcm90b3R5cGUvd2luZG93cy90aGVtZXMvbWFnZW50by5jc3MnOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuICdsaWIvcHJvdG90eXBlL3dpbmRvd3MvdGhlbWVzL21hZ2VudG8uY3NzJzsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRDc3NUeXBlKCkNCiAgICB7DQogICAgICAgIGlmICghJHRoaXMtPmdldElzQW55bW9yZVZlcnNpb24oMSwgNykpIHsNCiAgICAgICAgICAgIHJldHVybiAnanNfY3NzJzsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiAnc2tpbl9jc3MnOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgcHVibGljIGZ1bmN0aW9uIGdldEF2YWlsYWJsZVdlYnNpdGVzKCkNCiAgICB7DQogICAgICAgIHJldHVybiAkdGhpcy0+X3coKTsNCiAgICB9DQoNCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gX3coKQ0KICAgIHsNCiAgICAgICAgaWYgKCFNYWdlOjpnZXRTdG9yZUNvbmZpZygnZ29tYWdlX2FjdGl2YXRpb24vZGVzaWduZXIvaW5zdGFsbGVkJykgfHwNCiAgICAgICAgICAgIChpbnR2YWwoTWFnZTo6Z2V0U3RvcmVDb25maWcoJ2dvbWFnZV9hY3RpdmF0aW9uL2Rlc2lnbmVyL2NvdW50JykpID4gMTApDQogICAgICAgICkgew0KICAgICAgICAgICAgcmV0dXJuIGFycmF5KCk7DQogICAgICAgIH0NCg0KICAgICAgICAkdGltZV90b191cGRhdGUgPSA2MCAqIDYwICogMjQgKiAxNTsNCg0KICAgICAgICAkciA9IE1hZ2U6OmdldFN0b3JlQ29uZmlnKCdnb21hZ2VfYWN0aXZhdGlvbi9kZXNpZ25lci9hcicpOw0KICAgICAgICAkdCA9IE1hZ2U6OmdldFN0b3JlQ29uZmlnKCdnb21hZ2VfYWN0aXZhdGlvbi9kZXNpZ25lci90aW1lJyk7DQogICAgICAgICRzID0gTWFnZTo6Z2V0U3RvcmVDb25maWcoJ2dvbWFnZV9hY3RpdmF0aW9uL2Rlc2lnbmVyL3dlYnNpdGVzJyk7DQoNCiAgICAgICAgJGxhc3RfY2hlY2sgPSBzdHJfcmVwbGFjZSgkciwgJycsIE1hZ2U6OmhlbHBlcignY29yZScpLT5kZWNyeXB0KCR0KSk7DQoNCiAgICAgICAgJGFsbHNpdGVzID0gZXhwbG9kZSgnLCcsIHN0cl9yZXBsYWNlKCRyLCAnJywgTWFnZTo6aGVscGVyKCdjb3JlJyktPmRlY3J5cHQoJHMpKSk7DQogICAgICAgICRhbGxzaXRlcyA9IGFycmF5X2RpZmYoJGFsbHNpdGVzLCBhcnJheSgiIikpOw0KDQogICAgICAgIGlmICgoJGxhc3RfY2hlY2sgKyAkdGltZV90b191cGRhdGUpIDwgdGltZSgpKSB7DQogICAgICAgICAgICAkdGhpcy0+YShNYWdlOjpnZXRTdG9yZUNvbmZpZygnZ29tYWdlX2FjdGl2YXRpb24vZGVzaWduZXIva2V5JyksDQogICAgICAgICAgICAgICAgaW50dmFsKE1hZ2U6OmdldFN0b3JlQ29uZmlnKCdnb21hZ2VfYWN0aXZhdGlvbi9kZXNpZ25lci9jb3VudCcpKSwNCiAgICAgICAgICAgICAgICBpbXBsb2RlKCcsJywgJGFsbHNpdGVzKQ0KICAgICAgICAgICAgKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiAkYWxsc2l0ZXM7DQoNCiAgICB9DQoNCiAgICBwdWJsaWMgZnVuY3Rpb24gYSgkaywgJGMgPSAwLCAkcyA9ICcnKQ0KICAgIHsNCiAgICAgICAgJGNoID0gY3VybF9pbml0KCk7DQogICAgICAgIGN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9VUkwsIHNwcmludGYoJ2h0dHBzOi8vd3d3LmdvbWFnZS5jb20vaW5kZXgucGhwL2dvbWFnZV9kb3dubG9hZGFibGUva2V5L2NoZWNrJykpOw0KICAgICAgICBjdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfUE9TVCwgdHJ1ZSk7DQogICAgICAgIGN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9QT1NURklFTERTLCAna2V5PScgLiB1cmxlbmNvZGUoJGspIC4gJyZza3U9cHJvZHVjdC1kZXNpZ25lciZkb21haW5zPScgLiB1cmxlbmNvZGUoaW1wbG9kZSgnLCcsICR0aGlzLT5nZXRBbGxTdG9yZURvbWFpbnMoKSkpIC4gJyZ2ZXI9JyAuIHVybGVuY29kZSgnMi40LjAnKSk7DQogICAgICAgIGN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9USU1FT1VULCAzMCk7DQogICAgICAgIGN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9SRVRVUk5UUkFOU0ZFUiwgdHJ1ZSk7DQoNCiAgICAgICAgY3VybF9zZXRvcHQoJGNoLCBDVVJMT1BUX1NTTF9WRVJJRllQRUVSLCAwKTsNCiAgICAgICAgY3VybF9zZXRvcHQoJGNoLCBDVVJMT1BUX1NTTF9WRVJJRllIT1NULCAwKTsNCg0KICAgICAgICAkY29udGVudCA9IGN1cmxfZXhlYygkY2gpOw0KDQogICAgICAgIHRyeSB7DQogICAgICAgICAgICAkciA9IFplbmRfSnNvbjo6ZGVjb2RlKCRjb250ZW50KTsNCiAgICAgICAgfSBjYXRjaCAoXEV4Y2VwdGlvbiAkZSkgew0KICAgICAgICAgICAgJHIgPSBhcnJheSgpOw0KICAgICAgICB9DQoNCiAgICAgICAgJGUgPSBNYWdlOjpoZWxwZXIoJ2NvcmUnKTsNCiAgICAgICAgaWYgKGVtcHR5KCRyKSkgew0KDQogICAgICAgICAgICAkdmFsdWUxID0gTWFnZTo6Z2V0U3RvcmVDb25maWcoJ2dvbWFnZV9hY3RpdmF0aW9uL2Rlc2lnbmVyL2FyJyk7DQoNCiAgICAgICAgICAgICRncm91cHMgPSBhcnJheSgNCiAgICAgICAgICAgICAgICAnZGVzaWduZXInID0+IGFycmF5KA0KICAgICAgICAgICAgICAgICAgICAnZmllbGRzJyA9PiBhcnJheSgNCiAgICAgICAgICAgICAgICAgICAgICAgICdhcicgICAgICAgPT4gYXJyYXkoDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3ZhbHVlJyA9PiAkdmFsdWUxDQogICAgICAgICAgICAgICAgICAgICAgICApLA0KICAgICAgICAgICAgICAgICAgICAgICAgJ3dlYnNpdGVzJyA9PiBhcnJheSgNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAndmFsdWUnID0+IChzdHJpbmcpTWFnZTo6Z2V0U3RvcmVDb25maWcoJ2dvbWFnZV9hY3RpdmF0aW9uL2Rlc2lnbmVyL3dlYnNpdGVzJykNCiAgICAgICAgICAgICAgICAgICAgICAgICksDQogICAgICAgICAgICAgICAgICAgICAgICAndGltZScgICAgID0+IGFycmF5KA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICd2YWx1ZScgPT4gKHN0cmluZykkZS0+ZW5jcnlwdCgkdmFsdWUxIC4gKHRpbWUoKSAtICg2MCAqIDYwICogMjQgKiAxNSAtIDE4MDApKSAuICR2YWx1ZTEpDQogICAgICAgICAgICAgICAgICAgICAgICApLA0KICAgICAgICAgICAgICAgICAgICAgICAgJ2NvdW50JyAgICA9PiBhcnJheSgNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAndmFsdWUnID0+ICRjICsgMSkNCiAgICAgICAgICAgICAgICAgICAgKQ0KICAgICAgICAgICAgICAgICkNCiAgICAgICAgICAgICk7DQoNCiAgICAgICAgICAgIE1hZ2U6OmdldE1vZGVsKCdhZG1pbmh0bWwvY29uZmlnX2RhdGEnKQ0KICAgICAgICAgICAgICAgIC0+c2V0U2VjdGlvbignZ29tYWdlX2FjdGl2YXRpb24nKQ0KICAgICAgICAgICAgICAgIC0+c2V0R3JvdXBzKCRncm91cHMpDQogICAgICAgICAgICAgICAgLT5zYXZlKCk7DQoNCiAgICAgICAgICAgIE1hZ2U6OmdldENvbmZpZygpLT5yZWluaXQoKTsNCiAgICAgICAgICAgIE1hZ2U6OmFwcCgpLT5yZWluaXRTdG9yZXMoKTsNCg0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQoNCiAgICAgICAgJHZhbHVlMSA9ICcnOw0KICAgICAgICAkdmFsdWUyID0gJyc7DQoNCiAgICAgICAgaWYgKGlzc2V0KCRyWydkJ10pICYmIGlzc2V0KCRyWydjJ10pKSB7DQogICAgICAgICAgICAkdmFsdWUxID0gJGUtPmVuY3J5cHQoYmFzZTY0X2VuY29kZShaZW5kX0pzb246OmVuY29kZSgkcikpKTsNCg0KDQogICAgICAgICAgICBpZiAoISRzKSB7DQogICAgICAgICAgICAgICAgJHMgPSBNYWdlOjpnZXRTdG9yZUNvbmZpZygnZ29tYWdlX2FjdGl2YXRpb24vZGVzaWduZXIvd2Vic2l0ZXMnKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgJHMgPSBhcnJheV9zbGljZShleHBsb2RlKCcsJywgJHMpLCAwLCAkclsnYyddKTsNCg0KICAgICAgICAgICAgJHZhbHVlMiA9ICRlLT5lbmNyeXB0KCR2YWx1ZTEgLiBpbXBsb2RlKCcsJywgJHMpIC4gJHZhbHVlMSk7DQoNCiAgICAgICAgfQ0KICAgICAgICAkZ3JvdXBzID0gYXJyYXkoDQogICAgICAgICAgICAnZGVzaWduZXInID0+IGFycmF5KA0KICAgICAgICAgICAgICAgICdmaWVsZHMnID0+IGFycmF5KA0KICAgICAgICAgICAgICAgICAgICAnYXInICAgICAgICA9PiBhcnJheSgNCiAgICAgICAgICAgICAgICAgICAgICAgICd2YWx1ZScgPT4gJHZhbHVlMQ0KICAgICAgICAgICAgICAgICAgICApLA0KICAgICAgICAgICAgICAgICAgICAnd2Vic2l0ZXMnICA9PiBhcnJheSgNCiAgICAgICAgICAgICAgICAgICAgICAgICd2YWx1ZScgPT4gKHN0cmluZykkdmFsdWUyDQogICAgICAgICAgICAgICAgICAgICksDQogICAgICAgICAgICAgICAgICAgICd0aW1lJyAgICAgID0+IGFycmF5KA0KICAgICAgICAgICAgICAgICAgICAgICAgJ3ZhbHVlJyA9PiAoc3RyaW5nKSRlLT5lbmNyeXB0KCR2YWx1ZTEgLiB0aW1lKCkgLiAkdmFsdWUxKQ0KICAgICAgICAgICAgICAgICAgICApLA0KICAgICAgICAgICAgICAgICAgICAnaW5zdGFsbGVkJyA9PiBhcnJheSgNCiAgICAgICAgICAgICAgICAgICAgICAgICd2YWx1ZScgPT4gMQ0KICAgICAgICAgICAgICAgICAgICApLA0KICAgICAgICAgICAgICAgICAgICAnY291bnQnICAgICA9PiBhcnJheSgNCiAgICAgICAgICAgICAgICAgICAgICAgICd2YWx1ZScgPT4gMCkNCg0KICAgICAgICAgICAgICAgICkNCiAgICAgICAgICAgICkNCiAgICAgICAgKTsNCg0KICAgICAgICBNYWdlOjpnZXRNb2RlbCgnYWRtaW5odG1sL2NvbmZpZ19kYXRhJykNCiAgICAgICAgICAgIC0+c2V0U2VjdGlvbignZ29tYWdlX2FjdGl2YXRpb24nKQ0KICAgICAgICAgICAgLT5zZXRHcm91cHMoJGdyb3VwcykNCiAgICAgICAgICAgIC0+c2F2ZSgpOw0KDQogICAgICAgIE1hZ2U6OmdldENvbmZpZygpLT5yZWluaXQoKTsNCiAgICAgICAgTWFnZTo6YXBwKCktPnJlaW5pdFN0b3JlcygpOw0KDQogICAgfQ0KDQogICAgcHVibGljIGZ1bmN0aW9uIGdhKCkNCiAgICB7DQogICAgICAgICRhciA9IGJhc2U2NF9kZWNvZGUoTWFnZTo6aGVscGVyKCdjb3JlJyktPmRlY3J5cHQoTWFnZTo6Z2V0U3RvcmVDb25maWcoJ2dvbWFnZV9hY3RpdmF0aW9uL2Rlc2lnbmVyL2FyJykpKTsNCiAgICAgICAgcmV0dXJuICRhciA/IFplbmRfSnNvbjo6ZGVjb2RlKCRhcikgOiBhcnJheSgpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBmdW5jdGlvbiBub3RpZnkoKQ0KICAgIHsNCiAgICAgICAgJGZyZXF1ZW5jeSA9IGludHZhbChNYWdlOjphcHAoKS0+bG9hZENhY2hlKCdnb21hZ2Vfbm90aWZpY2F0aW9uc19mcmVxdWVuY3knKSk7DQogICAgICAgIGlmICghJGZyZXF1ZW5jeSkgew0KICAgICAgICAgICAgJGZyZXF1ZW5jeSA9IDI0Ow0KICAgICAgICB9DQogICAgICAgICRsYXN0X3VwZGF0ZSA9IGludHZhbChNYWdlOjphcHAoKS0+bG9hZENhY2hlKCdnb21hZ2Vfbm90aWZpY2F0aW9uc19sYXN0X3VwZGF0ZScpKTsNCg0KICAgICAgICBpZiAoKCRmcmVxdWVuY3kgKiA2MCAqIDYwICsgJGxhc3RfdXBkYXRlKSA+IHRpbWUoKSkgew0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQoNCiAgICAgICAgJHRpbWVzdGFtcCA9ICRsYXN0X3VwZGF0ZTsNCiAgICAgICAgaWYgKCEkdGltZXN0YW1wKSB7DQogICAgICAgICAgICAkdGltZXN0YW1wID0gdGltZSgpOw0KICAgICAgICB9DQoNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICRjaCA9IGN1cmxfaW5pdCgpOw0KICAgICAgICAgICAgY3VybF9zZXRvcHQoJGNoLCBDVVJMT1BUX1VSTCwgc3ByaW50ZignaHR0cHM6Ly93d3cuZ29tYWdlLmNvbS9pbmRleC5waHAvZ29tYWdlX25vdGlmaWNhdGlvbi9pbmRleC9kYXRhJykpOw0KICAgICAgICAgICAgY3VybF9zZXRvcHQoJGNoLCBDVVJMT1BUX1BPU1QsIHRydWUpOw0KICAgICAgICAgICAgY3VybF9zZXRvcHQoJGNoLCBDVVJMT1BUX1BPU1RGSUVMRFMsICdza3U9cHJvZHVjdC1kZXNpZ25lciZ0aW1lc3RhbXA9JyAuICR0aW1lc3RhbXAgLiAnJnZlcj0nIC4gdXJsZW5jb2RlKCcyLjUuMCcpKTsNCiAgICAgICAgICAgIGN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9USU1FT1VULCAzMCk7DQogICAgICAgICAgICBjdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfUkVUVVJOVFJBTlNGRVIsIHRydWUpOw0KDQogICAgICAgICAgICBjdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfU1NMX1ZFUklGWVBFRVIsIDApOw0KICAgICAgICAgICAgY3VybF9zZXRvcHQoJGNoLCBDVVJMT1BUX1NTTF9WRVJJRllIT1NULCAwKTsNCg0KICAgICAgICAgICAgJGNvbnRlbnQgPSBjdXJsX2V4ZWMoJGNoKTsNCg0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAkcmVzdWx0ID0gWmVuZF9Kc29uOjpkZWNvZGUoJGNvbnRlbnQpOw0KICAgICAgICAgICAgfSBjYXRjaCAoXEV4Y2VwdGlvbiAkZSkgew0KICAgICAgICAgICAgICAgICRyZXN1bHQgPSBhcnJheSgpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAoJHJlc3VsdCAmJiBpc3NldCgkcmVzdWx0WydmcmVxdWVuY3knXSkgJiYgKCRyZXN1bHRbJ2ZyZXF1ZW5jeSddICE9ICRmcmVxdWVuY3kpKSB7DQogICAgICAgICAgICAgICAgTWFnZTo6YXBwKCktPnNhdmVDYWNoZSgkcmVzdWx0WydmcmVxdWVuY3knXSwgJ2dvbWFnZV9ub3RpZmljYXRpb25zX2ZyZXF1ZW5jeScpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAoJHJlc3VsdCAmJiBpc3NldCgkcmVzdWx0WydkYXRhJ10pKSB7DQogICAgICAgICAgICAgICAgaWYgKCFlbXB0eSgkcmVzdWx0WydkYXRhJ10pKSB7DQogICAgICAgICAgICAgICAgICAgIE1hZ2U6OmdldE1vZGVsKCdhZG1pbm5vdGlmaWNhdGlvbi9pbmJveCcpLT5wYXJzZSgkcmVzdWx0WydkYXRhJ10pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uICRlKSB7DQogICAgICAgIH0NCg0KICAgICAgICBNYWdlOjphcHAoKS0+c2F2ZUNhY2hlKHRpbWUoKSwgJ2dvbWFnZV9ub3RpZmljYXRpb25zX2xhc3RfdXBkYXRlJyk7DQoNCiAgICB9DQp9DQo="));
