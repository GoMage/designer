<?xml version="1.0"?>
<!--
 /**
 * GoMage ProductDesigner Extension
 *
 * @category     Extension
 * @copyright    Copyright (c) 2010-2012 GoMage (http://www.gomage.com)
 * @author       GoMage
 * @license      http://www.gomage.com/license-agreement/  Single domain license
 * @terms of use http://www.gomage.com/terms-of-use
 * @version      Release: 1.0
 * @since        Available since Release 1.0
 */
 -->
<layout version="0.1.0">
    <gomage_designer_index_index translate="label">
        <label>GoMage Product Designer</label>
        <remove name="right"/>
        <remove name="left"/>
        <reference name="root">
            <action method="setTemplate"><template>page/1column.phtml</template></action>
        </reference>
        <reference name="head">
            <action method="addJs"><script>prototype/window.js</script></action>
            <action method="addJs"><script>varien/product.js</script></action>
            <action method="addItem"><type>js_css</type><name>prototype/windows/themes/default.css</name></action>
            <action method="addItem"><type>skin_css</type><name>lib/prototype/windows/themes/magento.css</name></action>
            <action method="addJs"><script>gomage/productdesigner/vendor/fabric.min.js</script></action>
            <action method="addJs"><script>gomage/productdesigner/vendor/excanvas.compiled.js</script></action>
            <action method="addJs"><script>gomage/productdesigner/editor.js</script></action>
            <action method="addItem"><type>skin_css</type><name>css/gomage/productdesigner.css</name><params/></action>
        </reference>
        <reference name="content">
            <block type="designer/editor" name="product_designer_editor" template="gomage/productdesigner/editor.phtml">
                <block type="designer/designer_navigation" name="productNavigator" template="gomage/productdesigner/designer/navigation.phtml">
                    <block type="designer/designer_navigation_filters" name="navigation.filters" template="gomage/productdesigner/designer/navigation/filters.phtml"/>
                    <block type="designer/designer_navigation_product_list" name="productNavigatorList" template="gomage/productdesigner/designer/navigation/list.phtml">
                        <block type="catalog/product_list_toolbar" name="product_navigator_toolbar" template="gomage/productdesigner/designer/navigation/toolbar.phtml">
                            <block type="page/html_pager" name="product_list_toolbar_pager"/>
                        </block>
                        <action method="setToolbarBlockName"><name>product_navigator_toolbar</name></action>
                    </block>
                </block>
                <block type="core/template" name="addDesign" template="gomage/productdesigner/designer/design.phtml">
                    <block type="designer/designer_design_filters" name="design.filters" template="gomage/productdesigner/designer/design/filters.phtml"/>
                    <block type="designer/designer_design_cliparts" name="design.cliparts" template="gomage/productdesigner/designer/design/cliparts.phtml"/>
                </block>
                <block type="designer/designer_text" name="addText" template="gomage/productdesigner/designer/text.phtml" />
                <block type="designer/designer_uploadImage" name="uploadImage" template="gomage/productdesigner/designer/upload_image.phtml">
                    <block type="designer/designer_uploadImage_images" name="uploadedImages" template="gomage/productdesigner/designer/upload_image/images.phtml" />
                </block>
                <block type="core/template" name="additionalInstructions" template="gomage/productdesigner/designer/additional_instructions.phtml" />
                <block type="core/template" name="customer_form_login" as="customer.login" template="gomage/productdesigner/customer/login.phtml"/>
                <block type="customer/form_register" name="customer_form_register" as="customer.register" template="gomage/productdesigner/customer/register.phtml"/>
                <block type="core/template" name="design.price" as="design_price" template="gomage/productdesigner/designer/price.phtml">
                    <action method="setProduct"><product helper="designer/initializeProduct"/></action>
                    <block type="catalog/product_price" name="product.price" template="catalog/product/price.phtml">
                        <action method="setIdSuffix"><id_suffix>-design</id_suffix></action>
                    </block>
                </block>
            </block>
        </reference>
    </gomage_designer_index_index>

    <gomage_designer_design_price>
        <block type="core/template" name="design.price" as="design_price" template="gomage/productdesigner/designer/price.phtml" output="toHtml">
            <action method="setProduct"><product helper="designer/initializeProduct"/></action>
            <block type="catalog/product_price" name="product.price" template="catalog/product/price.phtml">
                <action method="setIdSuffix"><id_suffix>-design</id_suffix></action>
            </block>
        </block>
    </gomage_designer_design_price>

    <gomage_designer_index_filterproducts>
        <reference name="content">
            <block type="designer/designer_navigation" name="productNavigator" template="gomage/productdesigner/designer/navigation.phtml">
                <block type="designer/designer_navigation_filters" name="navigation.filters" template="gomage/productdesigner/designer/navigation/filters.phtml"/>
                <block type="designer/designer_navigation_product_list" name="productNavigatorList" template="gomage/productdesigner/designer/navigation/list.phtml">
                    <block type="catalog/product_list_toolbar" name="product_navigator_toolbar" template="gomage/productdesigner/designer/navigation/toolbar.phtml">
                        <block type="page/html_pager" name="product_list_toolbar_pager"/>
                    </block>
                    <action method="setToolbarBlockName"><name>product_navigator_toolbar</name></action>
                </block>
            </block>
        </reference>
    </gomage_designer_index_filterproducts>

    <gomage_designer_index_filtercliparts>
        <reference name="content">
            <block type="core/template" name="design" template="gomage/productdesigner/designer/design.phtml">
                <block type="designer/designer_design_filters" name="design.filters" template="gomage/productdesigner/designer/design/filters.phtml"/>
                <block type="designer/designer_design_cliparts" name="design.cliparts" template="gomage/productdesigner/designer/design/cliparts.phtml"/>
            </block>
        </reference>
    </gomage_designer_index_filtercliparts>

    <gomage_designer_index_uploadimages translate="label">
        <reference name="content">
            <block type="designer/designer_uploadImage_images" name="uploadedImages" template="gomage/productdesigner/designer/upload_image/images.phtml" />
        </reference>
    </gomage_designer_index_uploadimages>
    <!-- Override templates to add "Customize it" button near "Add to cart button" -->
    <catalog_category_default>
        <reference name="product_list">
            <action method="setTemplate">
                <template>gomage/productdesigner/catalog/product/list.phtml</template>
            </action>
        </reference>
    </catalog_category_default>
    <catalog_category_layered>
        <reference name="product_list">
            <action method="setTemplate">
                <template>gomage/productdesigner/catalog/product/list.phtml</template>
            </action>
        </reference>
    </catalog_category_layered>
    <!-- Top links for logged in customer -->
    <customer_logged_in_top_links>
        <block type="page/template_links" name="top.links" as="topLinks" output="toHtml"/>
        <reference name="top.links">
            <action method="addLink" translate="label title" module="customer"><label>My Account</label><url helper="customer/getAccountUrl"/><title>My Account</title><prepare/><urlParams/><position>10</position></action>
            <action method="addLink" translate="label title" module="customer"><label>Log Out</label><url helper="customer/getLogoutUrl"/><title>Log Out</title><prepare/><urlParams/><position>100</position></action>
            <block type="wishlist/links" name="wishlist_link" />
            <action method="addLinkBlock"><blockName>wishlist_link</blockName></action>
            <block type="checkout/links" name="checkout_cart_link">
                <action method="addCartLink"></action>
                <action method="addCheckoutLink"></action>
            </block>
        </reference>
    </customer_logged_in_top_links>

    <customer_account>
    <!-- Mage_Sales -->
        <reference name="customer_account_navigation">
            <action method="addLink" translate="label" module="designer"><name>designs</name><path>gomage_designer/customer/designs/</path><label>My Saved Designs</label></action>
        </reference>
    </customer_account>

    <gomage_designer_customer_designs>
        <update handle="customer_account" />
        <reference name="my.account.wrapper">
            <block type="core/template" name="customer.designs" template="gomage/productdesigner/customer/designs.phtml">
                <action method="setTitle" translate="title">
                    <title>My Saved Designs</title>
                </action>
                <block type="designer/customer_designs" name="customer.design.list" as="design.list" template="gomage/productdesigner/customer/designs/list.phtml">
                    <block type="page/html_pager" name="pager"/>
                    <action method="setColumnCount"><count>4</count></action>
                </block>
            </block>
            <block type="customer/account_dashboard" name="customer.account.link.back" template="customer/account/link/back.phtml"/>
        </reference>
    </gomage_designer_customer_designs>

    <catalog_product_view>
        <reference name="product.info.media">
            <action method="setTemplate">
                <template>gomage/productdesigner/catalog/product/view/media.phtml</template>
            </action>
        </reference>
    </catalog_product_view>

    <PRODUCT_TYPE_simple translate="label" module="catalog">
        <reference name="product.info.options">
            <action method="setTemplate">
                <template>gomage/productdesigner/catalog/product/view/options.phtml</template>
            </action>
            <block type="core/template" name="product.info.option.design" as="product_option_design" template="gomage/productdesigner/catalog/product/view/options/design.phtml"/>
        </reference>
    </PRODUCT_TYPE_simple>

    <PRODUCT_TYPE_configurable translate="label" module="catalog">
        <reference name="product.info.options">
            <action method="setTemplate">
                <template>gomage/productdesigner/catalog/product/view/options.phtml</template>
            </action>
            <block type="core/template" name="product.info.option.design" as="product_option_design" template="gomage/productdesigner/catalog/product/view/options/design.phtml"/>
        </reference>
    </PRODUCT_TYPE_configurable>

    <checkout_cart_index>
        <reference name="checkout.cart">
            <action method="addItemRender"><type>simple</type><block>designer/checkout_cart_item_renderer</block><template>gomage/productdesigner/checkout/cart/item/default.phtml</template></action>
            <action method="addItemRender"><type>configurable</type><block>designer/checkout_cart_item_renderer_configurable</block><template>gomage/productdesigner/checkout/cart/item/default.phtml</template></action>
        </reference>
    </checkout_cart_index>

    <checkout_onepage_review>
        <reference name="root">
            <action method="addItemRender"><type>default</type><block>designer/checkout_cart_item_renderer</block><template>gomage/productdesigner/checkout/onepage/review/item.phtml</template></action>
            <action method="addItemRender"><type>configurable</type><block>designer/checkout_cart_item_renderer_configurable</block><template>gomage/productdesigner/checkout/onepage/review/item.phtml</template></action>
        </reference>
    </checkout_onepage_review>

    <checkout_multishipping_addresses>
        <reference name="checkout_addresses">
            <action method="addItemRender"><type>default</type><block>designer/checkout_cart_item_renderer</block><template>gomage/productdesigner/checkout/multishipping/item/default.phtml</template></action>
            <action method="addItemRender"><type>configurable</type><block>designer/checkout_cart_item_renderer_configurable</block><template>gomage/productdesigner/checkout/multishipping/item/default.phtml</template></action>
        </reference>
    </checkout_multishipping_addresses>

    <checkout_multishipping_shipping translate="label">
        <reference name="checkout_shipping">
            <action method="addItemRender"><type>default</type><block>designer/checkout_cart_item_renderer</block><template>gomage/productdesigner/checkout/multishipping/item/default.phtml</template></action>
            <action method="addItemRender"><type>configurable</type><block>designer/checkout_cart_item_renderer_configurable</block><template>gomage/productdesigner/checkout/multishipping/item/default.phtml</template></action>
        </reference>
        <reference name="checkout_billing_items">
            <action method="addItemRender"><type>default</type><block>designer/checkout_cart_item_renderer</block><template>gomage/productdesigner/checkout/multishipping/item/default.phtml</template></action>
            <action method="addItemRender"><type>configurable</type><block>designer/checkout_cart_item_renderer_configurable</block><template>gomage/productdesigner/checkout/multishipping/item/default.phtml</template></action>
        </reference>
    </checkout_multishipping_shipping>

    <checkout_multishipping_overview>
        <reference name="checkout_overview">
            <action method="addItemRender"><type>default</type><block>designer/checkout_cart_item_renderer</block><template>gomage/productdesigner/checkout/multishipping/item/default.phtml</template></action>
            <action method="addItemRender"><type>configurable</type><block>designer/checkout_cart_item_renderer_configurable</block><template>gomage/productdesigner/checkout/multishipping/item/default.phtml</template></action>
        </reference>
    </checkout_multishipping_overview>

    <default>
        <reference name="cart_sidebar">
            <action method="addItemRender"><type>simple</type><block>designer/checkout_cart_item_renderer</block><template>checkout/cart/sidebar/default.phtml</template></action>
            <action method="addItemRender"><type>configurable</type><block>designer/checkout_cart_item_renderer_configurable</block><template>checkout/cart/sidebar/default.phtml</template></action>
        </reference>
    </default>

    <sales_order_view translate="label">
        <reference name="order_items">
            <action method="addItemRender"><type>default</type><block>designer/sales_order_item_renderer_default</block><template>gomage/productdesigner/sales/order/items/renderer/default.phtml</template></action>
        </reference>
    </sales_order_view>

    <sales_order_print>
        <reference name="sales_order_print">
            <action method="addItemRender"><type>default</type><block>designer/sales_order_item_renderer_default</block><template>gomage/productdesigner/sales/order/items/renderer/default.phtml</template></action>
        </reference>
    </sales_order_print>

    <sales_email_order_items>
        <reference name="items">
            <action method="addItemRender"><type>default</type><block>designer/sales_order_email_items_default</block><template>gomage/productdesigner/sales/order/email/items/default.phtml</template></action>
        </reference>
    </sales_email_order_items>
</layout>